(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7917],{65550:function(e,t,n){Promise.resolve().then(n.bind(n,95817))},95817:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var i=n(57437),o=n(79647),a=n(17156),r=n(60335),s=n(14595),l=n(61169),c=n(48965),d=n(2265),h=(0,n(59018).Z)((0,i.jsx)("path",{d:"M11 17h2v-1h1c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1h-3v-1h4V8h-2V7h-2v1h-1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3v1H9v2h2zm9-13H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4V6h16z"}),"LocalAtm"),u=n(47703),x=n(85800),m=n(86934),f=n(16463),g=n(80219),p=n(89967),j=n(64379),C=n.n(j);let w=async()=>{let e=await fetch(p.x.url+"/banks/list",{method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()},S=[{field:"CONSECUTIVO",headerName:"Recibo",width:100},{field:"NIT",headerName:"NIT",width:150},{field:"RazonSocial",headerName:"Raz\xf3n Social",width:400},{field:"FECHA",headerName:"Fecha Recibo",width:200},{field:"TOTAL",headerName:"Total Recibo",width:150}];var N=()=>{let{auth:e}=(0,x.a)(),t=(0,f.useRouter)(),[n,j]=(0,d.useState)([]),[N,b]=(0,d.useState)([]),[v,E]=(0,d.useState)(""),[T,y]=(0,d.useState)(null),[I,O]=(0,d.useState)(0),[Z,k]=(0,d.useState)(""),[R,z]=(0,d.useState)([]),D=(0,o.Z)("(max-width: 600px)");(0,d.useEffect)(()=>{(async()=>{let e=await w();try{e&&j(e)}catch(e){console.log("Error al obtener los datos del banco",e)}})()},[]),(0,d.useEffect)(()=>{(async()=>{try{let t=await fetch(p.x.url+"/receipts/consult/Consignment?ProfileName=Vendedor&ID=".concat(e.ID,"&data=Pendiente"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("Error en la solicitud: ".concat(t.status));let n=await t.json();b(n)}catch(e){console.log("Error al obtener los datos de Pedidos Pendientes",e)}})()},[]);let A=(0,d.useCallback)(e=>{z(e);let t=e.reduce((e,t)=>{let n=N.find(e=>e.CONSECUTIVO===t);if(n&&n.TOTAL){let t=n.TOTAL.toString().replace(/[$,]/g,"");return e+(t=parseFloat(t)||0)}return e},0);O("".concat(Number(t.toFixed(2)).toLocaleString()))},[N]),L=async()=>{let n={BankId:T,UserId:e.IDSaler,ConsignmentNumber:Z,Total:I,Comments:v,Receipts:R};try{let e=await fetch(p.x.url+"/consignments/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){let t=await e.json();console.error("Error del Servidor",t),C().fire({icon:"error",title:"Error al crear la consignaci\xf3n",text:t.error||"Error Desconocido."});return}let i=await e.json();console.log("Respuesta exitosa",i),C().fire({icon:"success",title:"Consignaci\xf3n creada con \xe9xito",text:i.text}),t.push("./consignacion")}catch(e){console.error("Error de conexi\xf3n",e),C().fire({icon:"error",title:"Error de Red",text:"No se pudo conectar al servidor. Intente nuevamente m\xe1s tarde."})}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{}),(0,i.jsxs)(a.Z,{sx:{padding:2},children:[(0,i.jsxs)(a.Z,{sx:{display:"flex",flexDirection:D?"column":"row",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h2",{children:(0,i.jsx)("strong",{children:"ELABORAR CONSIGNACI\xd3N"})}),(0,i.jsx)(r.Z,{onClick:L,title:"Generar Consignaci\xf3n",children:(0,i.jsx)(h,{sx:{fontSize:60},color:"primary"})})]}),(0,i.jsx)(s.Z,{}),(0,i.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2,mt:4},children:[(0,i.jsxs)(g.Z,{container:!0,spacing:2,sx:{flexDirection:D?"column":"row"},children:[(0,i.jsxs)(g.Z,{size:{xs:12,md:6},children:[(0,i.jsx)("strong",{children:"Banco: "}),(0,i.jsx)(l.Z,{id:"bank-selector",fullWidth:!0,size:"small",disablePortal:!0,options:n,getOptionLabel:e=>e.BankName||"","aria-required":!0,onChange:(e,t)=>{y(t?t.ID:null)},renderInput:e=>(0,i.jsx)(c.Z,{...e,label:"Seleccione el Banco"})})]}),(0,i.jsxs)(g.Z,{size:{xs:12,md:6},children:[(0,i.jsx)("strong",{children:"Numero de Consignaci\xf3n: "}),(0,i.jsx)(c.Z,{value:Z,onChange:e=>k(e.target.value),size:"small",variant:"outlined",fullWidth:!0})]})]}),(0,i.jsx)("strong",{children:"Comentarios: "}),(0,i.jsx)(c.Z,{value:v,onChange:e=>E(e.target.value),id:"outlined-basic",multiline:!0,size:"small",variant:"outlined",fullWidth:!0})]}),(0,i.jsx)(a.Z,{sx:{height:295,width:"100%",mt:4},children:(0,i.jsx)(m._,{rows:N,columns:S,getRowId:e=>e.CONSECUTIVO,pageSizeOptions:[5],checkboxSelection:!0,disableRowSelectionOnClick:!0,density:"compact",onRowSelectionModelChange:e=>A(e),initialState:{pagination:{paginationModel:{pageSize:5}}}})}),(0,i.jsxs)(a.Z,{sx:{display:"flex",flexDirection:D?"column":"row",alignItems:"center",gap:2,mt:4},children:[(0,i.jsx)("strong",{children:"Total Consignaci\xf3n: "}),(0,i.jsx)(c.Z,{value:I,variant:"outlined",size:"small",fullWidth:D,sx:{width:D?"100%":250}})]})]})]})}}},function(e){e.O(0,[9461,5148,8965,3083,1092,6934,2398,7703,2971,7023,1744],function(){return e(e.s=65550)}),_N_E=e.O()}]);