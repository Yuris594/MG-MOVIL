"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3462],{74853:function(e,t,a){var o=a(94630),r=a(57437);t.Z=(0,o.Z)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},13462:function(e,t,a){a.r(t);var o=a(57437),r=a(70899),i=a(2069),l=a(94013),n=a(8350),s=a(46387),d=a(77584),c=a(58004),u=a(45451),m=a(74853),h=a(10932),x=a(93769),g=a(2265),p=a(59832),f=a(29239),C=a(5515),w=a.n(C);let S={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxHeight:"80vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,overflow:"auto",p:4,zIndex:1200};t.default=e=>{let{pedido:t,handleClose:a}=e,{auth:C}=(0,h.a)(),[b,N]=(0,g.useState)(""),[v,F]=(0,g.useState)(""),[I,P]=(0,g.useState)(""),[j,Z]=(0,g.useState)(""),[E,D]=(0,g.useState)(!1),[z,K]=(0,g.useState)(""),[y,O]=(0,g.useState)(""),[L,B]=(0,g.useState)(""),[A,R]=(0,g.useState)(""),[k,T]=(0,g.useState)(""),[_,U]=(0,g.useState)([]),J=(0,r.Z)("(max-width: 600px)"),M=()=>D(!1);(0,g.useEffect)(()=>{if(t){let e=(JSON.parse(localStorage.getItem("cotizacion"))||[]).find(e=>e.PKId===t.PKId);e&&(N(e.nit),F(e.notas),P(e.total),K(e.nombreC),B(e.impuesto),R(e.descuento),T(e.Documento1),Z(G(e.fecha)),W(e.articulosSeleccionados),U(e.articulosSeleccionados))}},[t]);let G=e=>{let t=new Date(e),a=t.getDate(),o=t.toLocaleString("es-CO",{month:"short"}),r=o.charAt(0).toUpperCase()+o.slice(1),i=t.getFullYear();return"".concat(r," ").concat(a,", ").concat(i)},q=e=>{let t=_.map(t=>t.PKcodigo===e.PKcodigo?{...t,Precio:e.Precio,Descuento:e.Descuento,cantped:e.cantped,Total:H(e)}:t);return U(t),W(t),e},H=e=>{let t=parseFloat(e.cantped)||0,a=parseFloat(e.Precio)||0,o=(parseFloat(e.Iva)||0)/100,r=(parseFloat(e.Descuento)||0)/100,i=t*a,l=i*r;return(i-l+(i-l)*o).toFixed(0)},V=e=>{w().fire({title:"\xbfSeguro que desea eliminar el art\xedculo?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",customClass:{popup:"swal-custom-zindex"}}).then(a=>{if(a.isConfirmed){let a=_.filter(t=>t.PKcodigo!==e.PKcodigo);U(a),W(a);let o=JSON.parse(localStorage.getItem("cotizacion"))||[],r=o.findIndex(e=>e.PKId===t.PKId);-1!==r&&(o[r].articulosSeleccionados=a,localStorage.setItem("cotizacion",JSON.stringify(o))),w().fire({text:"Art\xedculo eliminado correctamente.",icon:"success",timer:2e3,customClass:{popup:"swal-custom-zindex"}})}})},W=e=>{let t=0,a=0,o=0,r=0;e.forEach(e=>{let i=parseFloat(e.cantped)||0,l=parseFloat(e.Precio)||0,n=(parseFloat(e.Descuento)||0)/100,s=(parseFloat(e.Iva)||0)/100,d=i*l,c=d*n;o+=l*i*n,r+=l*i*s,t+=d-c+(d-c)*s,a+=d-c}),P(Number(t.toFixed(0)).toLocaleString()),O(Number(a.toFixed(0)).toLocaleString()),B(r.toFixed(0)),R(o.toFixed(0))},Y=async()=>{if(a(),!(await w().fire({title:"\xbfEst\xe1s Seguro?",text:"El pedido ser\xe1 movido de Cotizaciones a Pedidos Por Enviar.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, mover",cancelButtonText:"Cancelar"})).isConfirmed){w().fire({text:"El Pedido no se movi\xf3 y permance en Cotizaciones.",icon:"info",timer:3e3,showConfirmButton:!1});return}try{let e=JSON.parse(localStorage.getItem("pedidos"))||[],t=JSON.parse(localStorage.getItem("cotizacion"))||[],a=t.find(e=>e.PKId==e.PKId);if(!a){w().fire({title:"Pedido no encontrado",text:"No se pudo localizar el pedido en las cotizaciones. Por favor, revisa nuevamente.",icon:"error"});return}let o={PKId:a.PKId,Fecha:a.fecha,nombreC:a.nombreC,NitC:a.nit,total:a.total,NombreV:C.UserFullName,FKID_sellers:a.FKID_sellers,Notas:a.notas,NUMPED:"",Documento1:a.Documento1,pkid:a.PKId,FKId_clientes:a.nit,articulos:a.articulosSeleccionados};if(e.some(e=>e.PKId===o.PKId))w().fire({title:"Pedido dupliado",text:"El pedido ya fue movido anteriormente a Pedidos Por Enviar.",icon:"info"});else{e.push(o),localStorage.setItem("pedidos",JSON.stringify(e));let r=t.filter(e=>e.PKId!==a.PKId);localStorage.setItem("cotizacion",JSON.stringify(r)),await w().fire({title:"\xa1Movimiento Exitoso!",text:"El pedido ha sido guardado correctamente en Pedidos Por Enviar.",icon:"success",timer:3e3,showConfirmButton:!1}),router.push("./pedidoSinEnviar")}}catch(e){console.error("Error:",e),w().fire({title:"Oops...!",text:"Ocurri\xf3 un problema al intentar guardar el pedido. Intenta nuevamente.",icon:"error"})}};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(f.Z,{container:!0,spacing:2,direction:J?"column":"row",alignItems:"center",justifyContent:"space-between",children:(0,o.jsx)(f.Z,{size:12,children:(0,o.jsxs)(i.Z,{sx:{display:"flex",flexDirection:J?"column":"row",alignItems:"center",gap:2,marginBottom:2},children:[(0,o.jsx)("h3",{children:(0,o.jsx)("strong",{children:"EDITAR PEDIDOS"})}),(0,o.jsxs)(i.Z,{sx:{display:"flex",flexDirection:J?"column":"row",alignItems:"center",gap:2,marginLeft:J?0:"auto",width:J?"100%":"auto"},children:[(0,o.jsx)(l.Z,{onClick:()=>D(!0),variant:"contained",sx:{margin:1,backgroundColor:"#841dec",color:"white"},children:"Articulos"}),(0,o.jsx)(l.Z,{onClick:Y,variant:"contained",sx:{margin:1,backgroundColor:"#25ba25",color:"white"},children:"Convertir a Pedido"}),(0,o.jsx)(l.Z,{onClick:()=>{try{if(0===_.length){w().fire({title:"Oops...!",text:"Error al guardar el pedido. Debe incluir articulos.",icon:"error"});return}let e=JSON.parse(localStorage.getItem("cotizacion"))||[],o=e.findIndex(e=>e.PKId===t.PKId);if(-1!==o){let t={...e[o],articulosSeleccionados:_,impuesto:L,descuento:A,total:I,subTotal:y,notas:v,Documento1:k};e[o]=t,localStorage.setItem("cotizacion",JSON.stringify(e)),a(),w().fire({position:"top-end",title:"\xc9xito",text:"Los cambios se han guardado correctamente.",icon:"success",showConfirmButton:!1,timer:2e3})}}catch(e){w().fire({title:"Error",text:"No se encontr\xf3 el pedido a actualizar.",icon:"error",confirmButtonText:"Aceptar"})}},variant:"contained",sx:{margin:1,backgroundColor:"#d92020",color:"white"},children:"Guardar y Cerrar"})]})]})})}),(0,o.jsx)(n.Z,{}),(0,o.jsx)(f.Z,{size:{xs:12,sm:6},sx:{marginRigth:4,padding:2},children:(0,o.jsxs)(i.Z,{sx:{display:"flex",flexDirection:J?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,o.jsx)(s.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:j}),(0,o.jsx)(s.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:z}),(0,o.jsx)(s.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:b})]})}),(0,o.jsx)(f.Z,{size:{xs:12,sm:6},sx:{padding:2},children:(0,o.jsxs)(i.Z,{sx:{display:"flex",flexDirection:J?"column":"row",justifyContent:"center",alignItems:"center",gap:2,width:J?"100%":"auto"},children:[(0,o.jsx)(d.Z,{id:"standard-multiline-flexible",label:"Ingresar Notas",multiline:!0,maxRows:5,variant:"outlined",value:v,onChange:e=>F(e.target.value),sx:{width:400},inputProps:{maxLength:255}}),(0,o.jsx)(d.Z,{id:"standard-multiline-flexible",label:"Documento",multiline:!0,maxRows:3,variant:"outlined",value:k,onChange:e=>T(e.target.value),sx:{width:200},inputProps:{maxLength:50}}),(0,o.jsxs)(s.Z,{variant:"body1",children:["SubTotal: ",(0,o.jsx)("span",{style:{color:"red"},children:y})]}),(0,o.jsxs)(s.Z,{variant:"body1",children:["Total: ",(0,o.jsx)("span",{style:{color:"red"},children:I})]})]})}),(0,o.jsx)(f.Z,{size:12,sx:{flexGrow:1,marginBottom:2},children:(0,o.jsx)(i.Z,{sx:{width:"100%",heigth:J?500:750},children:(0,o.jsx)(x._,{rows:_,columns:[{field:"PKcodigo",headerName:"CODIGO",width:100,headerClassName:"header-bold"},{field:"Nombre",headerName:"REFERENCIA",width:320,headerClassName:"header-bold"},{field:"Unidad_Empaque",headerName:"UND",width:80,headerClassName:"header-bold"},{field:"Precio",headerName:"PRECIO",width:100,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},headerClassName:"header-bold",editable:!0},{field:"Iva",headerName:"IVA",width:80,valueFormatter:e=>{let t=parseFloat(e).toLocaleString();return"".concat(parseFloat(t).toFixed(1))},headerClassName:"header-bold"},{field:"Descuento",headerName:"DESC",width:80,valueFormatter:e=>{let t=parseFloat(e).toLocaleString();return"".concat(parseFloat(t).toFixed(1))},headerClassName:"header-bold",editable:!0},{field:"cantped",headerName:"CANT",width:80,headerClassName:"header-bold",editable:!0},{field:"Total",headerName:"TOTAL",width:90,valueFormatter:e=>{let t=Number(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},headerClassName:"header-bold"},{field:"actions",headerName:"",width:70,renderCell:e=>(0,o.jsx)(p.Z,{onClick:()=>V(e.row),"aria-label":"cancel",color:"error",sx:{fontSize:40},children:(0,o.jsx)(m.Z,{})})}],getRowId:e=>e.PKcodigo,rowHeight:40,pageSizeOptions:[10],initialState:{pagination:{paginationModel:{pageSize:10}}},processRowUpdate:e=>q(e),onProcessRowUpdateError:e=>{console.error("Error durante la actualizaci\xf3n de la fila:",e),alert("Ocurri\xf3 un error al actualizar la fila. Intenta nuevamente.")}})})}),(0,o.jsx)(c.Z,{open:E,onClose:M,children:(0,o.jsx)(i.Z,{sx:S,children:(0,o.jsx)(u.default,{handleClose:M,onAgregarArticulo:e=>{let t=[..._,...e.map(e=>{let t=e.Precio*(1+e.Iva/100)*e.cantped;return{...e,Total:t.toFixed(0)}})];U(t),W(t)}})})})]})}},45451:function(e,t,a){a.r(t);var o=a(57437),r=a(70899),i=a(77584),l=a(2069),n=a(94013),s=a(8350),d=a(42569),c=a(93769),u=a(2265),m=a(29239);t.default=e=>{let{handleClose:t,onAgregarArticulo:a}=e,[h,x]=(0,u.useState)([]),[g,p]=(0,u.useState)(""),[f,C]=(0,u.useState)({}),[w,S]=(0,u.useState)([]),b=(0,r.Z)("(max-width: 600px)");(0,u.useEffect)(()=>{(async()=>{try{let e=await (0,d.zK)(),t=await e.getAll("articles");t.length>0?(x(t),S(t),console.log("Datos cargados desde la base de datos")):console.log("No se encontraron art\xedculos en la base de datos.")}catch(e){console.log("Error al obtener los productos:",e)}})()},[]);let N=(e,t)=>{C({...f,[e]:t})},v=e=>{x(w.filter(t=>Object.values(t).map(e=>e?e.toString().toLowerCase():"").some(t=>t.includes(e.toLowerCase()))))};return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(m.Z,{container:!0,direction:"column",sx:{minHeight:"100vh",backfroundColor:"#ffffff",padding:2},children:[(0,o.jsx)(m.Z,{size:12,children:(0,o.jsxs)(l.Z,{sx:{display:"flex",flexDirection:b?"column":"row",alignItems:"center",gap:2,marginBottom:2},children:[(0,o.jsx)("h2",{children:(0,o.jsx)("strong",{children:"SELECCIONAR ARTICULO"})}),(0,o.jsxs)(l.Z,{sx:{display:"flex",flexDirection:b?"column":"row",alignItems:"center",gap:2,marginLeft:b?0:"auto",width:b?"100%":"auto"},children:[(0,o.jsx)(n.Z,{variant:"outlined",color:"success",sx:{margin:1},onClick:()=>{a(h.filter(e=>f[e.PKcodigo]).map(e=>({...e,cantped:f[e.PKcodigo]}))),t()},children:"Agregar"}),(0,o.jsx)(n.Z,{variant:"contained",color:"error",onClick:t,children:"Cerrar"})]})]})}),(0,o.jsx)(s.Z,{}),(0,o.jsx)(m.Z,{size:12,sx:{padding:2},children:(0,o.jsx)(i.Z,{id:"outlined-basic",label:"Digite Codigo o Referencia para Buscar",multiline:!0,rows:1,variant:"outlined",value:g,onChange:e=>{e.preventDefault(),p(e.target.value),v(e.target.value)},sx:{width:"100%"}})}),(0,o.jsx)(m.Z,{size:12,sx:{flexGrow:1,marginBottom:2},children:(0,o.jsx)(l.Z,{sx:{width:"100%",height:b?500:820},children:(0,o.jsx)(c._,{density:"compact",rows:h,columns:[{field:"PKcodigo",headerName:"COD",width:100,headerClassName:"header-bold"},{field:"Nombre",headerName:"REFERENCIA",width:280,headerClassName:"header-bold"},{field:"Unidad_Empaque",headerName:"EMP",width:80,headerClassName:"header-bold"},{field:"Precio",headerName:"PRECIO",width:90,editable:!0,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},headerClassName:"header-bold"},{field:"Iva",headerName:"IVA",width:80,valueFormatter:e=>{let t=parseFloat(e).toLocaleString();return"".concat(parseFloat(t).toFixed(1))},headerClassName:"header-bold"},{field:"Descuento",headerName:"DESC",width:80,valueFormatter:e=>{let t=parseFloat(e).toLocaleString();return"".concat(parseFloat(t).toFixed(1))},editable:!0,headerClassName:"header-bold"},{field:"cantped",headerName:"CANT",width:100,headerClassName:"header-bold",renderCell:e=>(0,o.jsx)(i.Z,{size:"small",value:f[e.id]||"",onChange:t=>{let a=t.target.value;/^\d*$/.test(a)&&N(e.id,a)},sx:{width:"70px",height:"20px"},type:"text",inputProps:{inputMode:"numeric"}}),type:"number"},{field:"Precio_Neto",headerName:"NETO",width:80,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},headerClassName:"header-bold"},{field:"Disp",headerName:"DISP",width:80,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},headerClassName:"header-bold"}],getRowId:e=>e.PKcodigo,processRowUpdate:e=>{let t=h.map(t=>t.PKcodigo===e.PKcodigo?{...t,...e}:t);return x(t),S(t),e},initialState:{pagination:{paginationModel:{pageSize:20}}},pageSizeOptions:[20]})})})]})})}}}]);