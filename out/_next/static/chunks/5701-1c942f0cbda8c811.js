"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5701],{19492:function(e,t,o){var a=o(59018),i=o(57437);t.Z=(0,a.Z)((0,i.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},85701:function(e,t,o){o.r(t),o.d(t,{default:function(){return j}});var a=o(57437),i=o(79647),r=o(17156),n=o(76548),l=o(14595),c=o(83719),s=o(48965),d=o(37241),u=o(44964),h=o(19492),m=o(85800);o(27824);var x=o(97501),g=o(59846),f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,s=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0,h=arguments.length>12?arguments[12]:void 0,m=()=>{let e=new Date;return(0,g.WU)(e,"yyyy-MM-dd HH:mm:ss")};return{generarPDF:()=>{let g=new x.default("portrait","pt","letter"),f=[{field:"PKcodigo",headerName:"REF.",width:120},{field:"cantped",headerName:"CANT",width:70},{field:"Unidad_Empaque",headerName:"UND",width:70},{field:"Nombre",headerName:"DESCRIPCI\xd3N",width:450},{field:"Iva",headerName:"IVA",width:60},{field:"Descuento",headerName:"DESC",width:70},{field:"Precio",headerName:"VALOR UNI",width:70},{field:"Total",headerName:"TOTAL",width:100}],p=e.map(e=>{let t=[];return f.forEach(o=>{let a=e[o.field];("Precio"===o.field||"Total"===o.field)&&(a="$"+parseFloat(Number(a).toFixed(0)).toLocaleString()),t.push(a)}),t});g.setFontSize(12),g.setFont("times","normal"),g.addImage("/logo_factura.png","PNG",16,20,200,25),g.text("NIT. 890.900.137-1",50,55),g.setFontSize(8),g.setFont("courier","italic"),g.text("NOMBRE VENDEDOR: ".concat(t.UserFullName),450,25),g.text("".concat(m()),450,35),g.setFontSize(10),g.text("____________________________________________________________________________________________",14,60),g.setFont("times","italic"),g.setFontSize(10),g.text("CLIENTE: ".concat(o),16,85),g.text("NIT: ".concat(a),16,105),g.text("TEL\xc9FONO: ".concat(i),200,105),g.text("FECHA: ".concat(r),400,105),g.text("DIRECCI\xd3N: ".concat(n),16,125),g.text("MUNICIPIO: ".concat(l),200,125),g.text("NOTAS: ".concat(c),16,145),g.autoTable({head:[f.map(e=>e.headerName)],body:p,startY:180,theme:"plain",tableWidth:g.internal.pageSize.width-28,margin:{left:12,right:16},styles:{theme:"plain",cellWidth:"auto",styles:{cellPadding:5,fontSize:8},lineColor:[200,200,200],lineWidth:.1,font:"times",fontStyle:"normal",textColor:[0,0,0],display:"flex",fontSize:8},headStyles:{font:"courier",fontStyle:"bold"}}),g.setFontSize(10),g.setFont("times","italic"),g.text("TOTAL ITEMS:        ".concat(e.length),350,g.autoTable.previous.finalY+80),g.text("SubTotal:     ".concat(s.toLocaleString("es-ES")),470,g.autoTable.previous.finalY+20),g.text("Desc:         ".concat(d.toLocaleString("es-ES"),"  "),470,g.autoTable.previous.finalY+40),g.text("IVA:          ".concat(u.toLocaleString("es-ES"),"   "),470,g.autoTable.previous.finalY+60),g.text("TOTAL:        ".concat(h.toLocaleString("es-ES")),470,g.autoTable.previous.finalY+80),g.rect(10,g.autoTable.previous.finalY+9,450,88),g.rect(463,g.autoTable.previous.finalY+9,120,88),g.output("dataurlnewwindow")}}},p=o(86934),_=o(2265),w=o(60335),S=o(80219),v=o(89967),C=o(64379),N=o.n(C);let b={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,overflow:"auto",p:4,zIndex:1300};var j=e=>{let{pedido:t,handleClose:o}=e,{auth:x}=(0,m.a)(),[g,C]=(0,_.useState)(""),[j,E]=(0,_.useState)(""),[P,I]=(0,_.useState)(""),[F,y]=(0,_.useState)(""),[D,T]=(0,_.useState)(!1),[Z,O]=(0,_.useState)(""),[z,K]=(0,_.useState)(""),[L,k]=(0,_.useState)(""),[A,B]=(0,_.useState)(""),[R,U]=(0,_.useState)(""),[J,M]=(0,_.useState)(""),[Y,H]=(0,_.useState)(""),[W,$]=(0,_.useState)(""),[q,G]=(0,_.useState)([]),V=(0,i.Z)("(max-width: 600px)"),Q=f(q,x,Z,g,z,F,J,Y,j,L,R,A,P),X=()=>T(!1);(0,_.useEffect)(()=>{if(t){let e=(JSON.parse(localStorage.getItem("cotizacion"))||[]).find(e=>e.PKId===t.PKId);e&&(C(e.NitC),E(e.Notas),I(e.total),O(e.nombreC),B(e.impuesto),K(e.telefonoC),U(e.descuento),H(e.municipioC),M(e.direccionC),$(e.Documento1),eo(e.articulos),y(ee(e.Fecha)),G(e.articulos))}},[t]);let ee=e=>{let t=new Date(e),o=t.getDate(),a=t.toLocaleString("es-CO",{month:"short"}),i=a.charAt(0).toUpperCase()+a.slice(1),r=t.getFullYear();return"".concat(i," ").concat(o,", ").concat(r)},et=e=>{N().fire({title:"\xbfSeguro que desea eliminar el articulo?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",customClass:{popup:"swal-popup-zindex"}}).then(t=>{if(t.isConfirmed){let t=q.filter(t=>t.PKcodigo!==e.PKcodigo);G(t),eo(t)}})},eo=e=>{let t=0,o=0;e.forEach(e=>{let a=parseFloat(e.cantped)||0,i=parseFloat(e.Precio)||0,r=(parseFloat(e.Descuento)||0)/100,n=(parseFloat(e.Iva)||0)/100,l=a*i,c=l*r;t+=l-c+(l-c)*n,o+=l-c}),I(t.toFixed(0)),k(o.toFixed(0))},ea=async()=>{try{let e=await fetch(v.x.url+"/pedidos/".concat(x.IDSaler),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error al obtener el consecutivo: ".concat(e.status," ").concat(e.statusText));let t=await e.json();if(!t[0].consecutivo||!t[0].Prefijo)throw Error("Los campos 'consecutivo' o 'Prefijo' no se encontraron en la respuesta.");return t[0]}catch(e){throw console.error("Error al obtener el consecutivo:",e),e}},ei=async()=>{if(o(),!(await N().fire({title:"Almacenar!",text:"\xbfDesea almacenar el Pedido?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"})).isConfirmed){N().fire({text:"El Pedido no se almacen\xf3.",icon:"info",timer:3e3});return}try{let e=JSON.parse(localStorage.getItem("pedidos"))||[],t=e.find(e=>e.PKId==e.PKId);if(!t)throw Error("El pedido no se encontr\xf3 en el almacenamiento local.");let o=await ea(),a=o.consecutivo+1,i="".concat(o.Prefijo).concat(a),r=await fetch(v.x.url+"/pedidos/PEDIDOS/".concat(x.IDSaler),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Consecutivo:a})});if(!r.ok)throw console.log("Error al actualizar el consecutivo:",r.statusText),Error("Error al actualizar el consecutivo");console.log("Consecutivo actualizado correctamente");let n={FKID_sellers:t.FKID_sellers,Notas:t.Notas,FKId_clientes:t.FKId_clientes,NUMPED:i,Documento1:t.Documento1},l=await fetch(v.x.url+"/pedidos/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!l.ok){let e=await l.json();throw console.error("Error al crear el pedido",e),Error("Error al crear el encabezado del pedido")}for(let e of(console.log("Pedido creado correctamente"),q.map(e=>({FKid_pedidos2:e.FKid_pedidos2.toString(),FKcodigo_articles:e.PKcodigo,Cantidad:e.cantped,Precio:e.Precio.toString(),Descuento:e.Descuento.toString(),Iva:e.Iva.toString(),Total:e.Total,FKNUMPED:i,BODEGA:e.BODEGA})))){let t=await fetch(v.x.url+"/pedidos/".concat(i),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw console.error("Error al crear el detalle del pedido:",e),Error("Error al crear el detalle del pedido: ".concat(t.status," - ").concat(t.statusText))}}console.log("Detalle del pedido creado correctamente");let c=e.filter(e=>e.PKId!==t.PKId);localStorage.setItem("pedidos",JSON.stringify(c)),N().fire({title:"\xa1\xc9xito!",text:"Pedido Fue Almacenado Correctamente.",icon:"success",timer:3e3})}catch(e){console.error("Error:",e),N().fire({title:"Oops...!",text:"Hubo un Problema al Enviar el Pedido.",icon:"error"})}},er=async()=>{if(!consecutivo||!g){N().fire({icon:"warning",title:"Datos Faltantes",text:"Por favor, asegurate de que el N\xfamero del Recibo y el Nit est\xe9n definidos."});return}try{let e=await fetch(v.x.url+"/receipts/sendmail/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify()});if(e.ok){let t=await e.json();o(),N().fire({position:"top-end",icon:"success",title:"Email Enviado con Exito!.",text:"".concat(t.text),showConfirmButton:!1,timer:2500})}else N().fire({icon:"error",title:"Oops...",text:"Error al Enviar el Email!."})}catch(e){N().fire({icon:"error",title:"Error de Red",text:"No se pudo Enviar el Correo debido a un Problema de Red."})}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S.Z,{container:!0,spacing:2,direction:V?"column":"row",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsx)("h3",{children:(0,a.jsx)("strong",{children:"PEDIDOS"})}),(0,a.jsx)(S.Z,{size:{xs:12,sm:8},sx:{padding:2},children:(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:V?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,a.jsx)(n.Z,{onClick:()=>T(!0),variant:"contained",sx:{margin:1,backgroundColor:"#4eeacb",color:"white"},children:"Articulos"}),(0,a.jsx)(n.Z,{onClick:ei,variant:"contained",sx:{margin:1,backgroundColor:"#25ba25",color:"white"},children:"Pedido"}),(0,a.jsx)(n.Z,{onClick:er,variant:"contained",sx:{margin:1,backgroundColor:"#d920ba",color:"white"},children:"Enviar"}),(0,a.jsx)(n.Z,{onClick:Q.generarPDF,variant:"contained",sx:{margin:1,backgroundColor:"#841dec",color:"white"},children:"PDF"}),(0,a.jsx)(n.Z,{onClick:()=>{let e=JSON.parse(localStorage.getItem("cotizacion"))||[],a=e.findIndex(e=>e.PKId===t.PKId);if(-1!==a){let t={...e[a],articulos:q,impuesto:A,descuento:R,total:P,subTotal:L,Notas:j,Documento1:W};e[a]=t,localStorage.setItem("cotizacion",JSON.stringify(e)),o(),N().fire({position:"top-end",title:"\xc9xito",text:"Los cambios se han guardado correctamente.",icon:"success",showConfirmButton:!1,timer:2e3})}else N().fire({title:"Error",text:"No se encontr\xf3 el pedido a actualizar.",icon:"error",confirmButtonText:"Aceptar"})},variant:"contained",sx:{margin:1,backgroundColor:"#d92020",color:"white"},children:"Cambios y Cerrar"})]})})]}),(0,a.jsx)(l.Z,{}),(0,a.jsx)(S.Z,{size:{xs:12,sm:6},sx:{marginRigth:4,padding:2},children:(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:V?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,a.jsx)(c.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:F}),(0,a.jsx)(c.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:Z}),(0,a.jsx)(c.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:g})]})}),(0,a.jsx)(S.Z,{size:{xs:12,sm:6},sx:{padding:2},children:(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:V?"column":"row",justifyContent:"center",alignItems:"center",gap:2,width:V?"100%":"auto"},children:[(0,a.jsx)(s.Z,{id:"standard-multiline-flexible",label:"Ingresar Notas",multiline:!0,maxRows:5,variant:"outlined",value:j,onChange:e=>E(e.target.value),sx:{width:400},inputProps:{maxLength:255}}),(0,a.jsx)(s.Z,{id:"standard-multiline-flexible",label:"Documento",multiline:!0,maxRows:3,variant:"outlined",value:W,onChange:e=>$(e.target.value),sx:{width:200},inputProps:{maxLength:50}}),(0,a.jsxs)(c.Z,{variant:"body1",children:["SubTotal: ",(0,a.jsxs)("span",{style:{color:"red"},children:["$",L]})]}),(0,a.jsxs)(c.Z,{variant:"body1",children:["Total: ",(0,a.jsxs)("span",{style:{color:"red"},children:["$",P]})]})]})}),(0,a.jsx)(S.Z,{size:12,sx:{flexGrow:1,marginBottom:2},children:(0,a.jsx)(r.Z,{sx:{width:"100%",heigth:V?500:750},children:(0,a.jsx)(p._,{rows:q,columns:[{field:"PKcodigo",headerName:"Codigo",width:100},{field:"Nombre",headerName:"Referencia",width:320},{field:"Unidad_Empaque",headerName:"Und",width:80},{field:"Precio",headerName:"Precio",width:100,valueFormatter:e=>{let t=Number(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString("es-ES"))}},{field:"Iva",headerName:"Iva",width:80},{field:"Descuento",headerName:"Desc",width:80},{field:"cantped",headerName:"Cant",width:80},{field:"Total",headerName:"Total",width:90,valueFormatter:e=>{let t=Number(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString("es-ES"))}},{field:"actions",headerName:"",width:70,renderCell:e=>(0,a.jsx)(w.Z,{onClick:()=>et(e.row),"aria-label":"cancel",color:"error",sx:{fontSize:40},children:(0,a.jsx)(h.Z,{})})}],getRowId:e=>e.PKcodigo,rowHeight:40,pageSizeOptions:[10],initialState:{pagination:{paginationModel:{pageSize:10}}}})})}),(0,a.jsx)(d.Z,{open:D,onClose:X,children:(0,a.jsx)(r.Z,{sx:b,children:(0,a.jsx)(u.default,{handleClose:X,onAgregarArticulo:e=>{let t=[...q,...e.map(e=>{let t=e.Precio*(1+e.Iva/100)*e.cantped;return{...e,Total:t.toFixed(0)}})];G(t),eo(t)}})})})]})}},44964:function(e,t,o){o.r(t);var a=o(57437),i=o(79647),r=o(48965),n=o(17156),l=o(76548),c=o(14595),s=o(59415),d=o(86934),u=o(2265),h=o(80219);t.default=e=>{let{handleClose:t,onAgregarArticulo:o}=e,[m,x]=(0,u.useState)([]),[g,f]=(0,u.useState)(""),[p,_]=(0,u.useState)({}),[w,S]=(0,u.useState)([]),v=(0,i.Z)("(max-width: 600px)");(0,u.useEffect)(()=>{(async()=>{try{let e=await (0,s.zK)(),t=await e.getAll("articles");t.length>0?(x(t),S(t),console.log("Datos cargados desde la base de datos")):console.log("No se encontraron art\xedculos en la base de datos.")}catch(e){console.log("Error al obtener los productos:",e)}})()},[]);let C=(e,t)=>{_({...p,[e]:t})},N=e=>{x(w.filter(t=>Object.values(t).map(e=>e?e.toString().toLowerCase():"").some(t=>t.includes(e.toLowerCase()))))};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(h.Z,{container:!0,direction:"column",sx:{minHeight:"100vh",backfroundColor:"#ffffff",padding:2},children:[(0,a.jsx)(h.Z,{size:12,children:(0,a.jsxs)(n.Z,{sx:{display:"flex",flexDirection:v?"column":"row",alignItems:"center",gap:2,marginBottom:2},children:[(0,a.jsx)("h2",{children:(0,a.jsx)("strong",{children:"SELECCIONAR ARTICULO"})}),(0,a.jsxs)(n.Z,{sx:{display:"flex",flexDirection:v?"column":"row",alignItems:"center",gap:2,marginLeft:v?0:"auto",width:v?"100%":"auto"},children:[(0,a.jsx)(l.Z,{variant:"outlined",color:"success",sx:{margin:1},onClick:()=>{o(m.filter(e=>p[e.PKcodigo]).map(e=>({...e,cantped:p[e.PKcodigo]}))),t()},children:"Agregar"}),(0,a.jsx)(l.Z,{variant:"contained",color:"error",onClick:t,children:"Cerrar"})]})]})}),(0,a.jsx)(c.Z,{}),(0,a.jsx)(h.Z,{size:12,sx:{padding:2},children:(0,a.jsx)(r.Z,{id:"outlined-basic",label:"Digite Codigo o Referencia para Buscar",multiline:!0,rows:1,variant:"outlined",value:g,onChange:e=>{e.preventDefault(),f(e.target.value),N(e.target.value)},sx:{width:"100%"}})}),(0,a.jsx)(h.Z,{size:12,sx:{flexGrow:1,marginBottom:2},children:(0,a.jsx)(n.Z,{sx:{width:"100%",height:v?500:820},children:(0,a.jsx)(d._,{density:"compact",rows:m,columns:[{field:"PKcodigo",headerName:"Cod",width:100},{field:"Nombre",headerName:"Referencia",width:280},{field:"Unidad_Empaque",headerName:"Emp",width:80},{field:"Precio",headerName:"Precio",width:90,editable:!0,valueFormatter:e=>{let t=Number(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString())}},{field:"Iva",headerName:"Iva",width:80},{field:"Descuento",headerName:"Des",width:80,editable:!0},{field:"cantped",headerName:"Cant",width:100,renderCell:e=>(0,a.jsx)(r.Z,{size:"small",value:p[e.id]||"",onChange:t=>C(e.id,t.target.value),sx:{width:"70px",height:"20px"}})},{field:"Precio_Neto",headerName:"Neto",width:80,valueFormatter:e=>{let t=Number(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString())}},{field:"Disp",headerName:"Disp",width:80}],getRowId:e=>e.PKcodigo,processRowUpdate:e=>{let t=m.map(t=>t.PKcodigo===e.PKcodigo?{...t,...e}:t);return x(t),S(t),e},initialState:{pagination:{paginationModel:{pageSize:20}}},pageSizeOptions:[20]})})})]})})}}}]);