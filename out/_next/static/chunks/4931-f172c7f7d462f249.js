"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4931],{52035:(e,t,o)=>{o.d(t,{A:()=>i});var a=o(12983),r=o(95155);let i=(0,a.A)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},64931:(e,t,o)=>{o.r(t),o.d(t,{default:()=>A});var a=o(95155),r=o(23165),i=o(2572),n=o(22282),l=o(2241),c=o(9561),s=o(19293),d=o(92608),u=o(54941),h=o(52035),m=o(70689),g=o(30251),x=o(12115),p=o(894),f=o(48097),w=o(8889),S=o(78897),j=o.n(S);let C={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,overflow:"auto",p:4,zIndex:1200},A=e=>{let{pedido:t,handleClose:o}=e,{auth:S}=(0,m.A)(),[A,v]=(0,x.useState)(""),[b,I]=(0,x.useState)(""),[P,N]=(0,x.useState)(""),[D,E]=(0,x.useState)(""),[F,y]=(0,x.useState)(!1),[K,z]=(0,x.useState)(""),[O,T]=(0,x.useState)(""),[B,k]=(0,x.useState)(""),[L,_]=(0,x.useState)(""),[R,J]=(0,x.useState)(""),[U,$]=(0,x.useState)([]),G=(0,r.A)("(max-width: 600px)"),q=()=>y(!1);(0,x.useEffect)(()=>{if(t){let e=(JSON.parse(localStorage.getItem("cotizacion"))||[]).find(e=>e.PKId===t.PKId);e&&(v(e.nit),I(e.notas),N(e.total),z(e.nombreC),k(e.impuesto),_(e.descuento),J(e.Documento1),E(H(e.fecha)),X(e.articulosSeleccionados),$(e.articulosSeleccionados))}},[t]);let H=e=>{let t=new Date(e),o=t.getDate(),a=t.toLocaleString("es-CO",{month:"short"}),r=a.charAt(0).toUpperCase()+a.slice(1),i=t.getFullYear();return"".concat(r," ").concat(o,", ").concat(i)},M=[{field:"PKcodigo",headerName:"Codigo",width:100},{field:"Nombre",headerName:"Referencia",width:320},{field:"Unidad_Empaque",headerName:"Und",width:80},{field:"Precio",headerName:"Precio",width:100,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString("es-ES"))}},{field:"Iva",headerName:"Iva",width:80},{field:"Descuento",headerName:"Desc",width:80},{field:"cantped",headerName:"Cant",width:80},{field:"Total",headerName:"Total",width:90,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString("es-ES"))}},{field:"actions",headerName:"",width:70,renderCell:e=>(0,a.jsx)(p.A,{onClick:()=>W(e.row),"aria-label":"cancel",color:"error",sx:{fontSize:40},children:(0,a.jsx)(h.A,{})})}],W=e=>{o(),j().fire({title:"\xbfSeguro que desea eliminar el art\xedculo?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar"}).then(o=>{if(o.isConfirmed){let o=U.filter(t=>t.PKcodigo!==e.PKcodigo);$(o),X(o);let a=JSON.parse(localStorage.getItem("cotizacion"))||[],r=a.findIndex(e=>e.PKId===t.PKId);-1!==r&&(a[r].articulosSeleccionados=o,localStorage.setItem("cotizacion",JSON.stringify(a))),j().fire({text:"Art\xedculo eliminado correctamente.",icon:"success",timer:2e3})}})},X=e=>{let t=0,o=0,a=0,r=0;e.forEach(e=>{let i=parseFloat(e.cantped)||0,n=parseFloat(e.Precio)||0,l=(parseFloat(e.Descuento)||0)/100,c=(parseFloat(e.Iva)||0)/100,s=i*n,d=s*l;a+=n*i*l,r+=n*i*c,t+=s-d+(s-d)*c,o+=s-d}),N(t.toFixed(0)),T(o.toFixed(0)),k(r.toFixed(0)),_(a.toFixed(0))},Y=async()=>{try{let e=await fetch(w.m.url+"/pedidos/".concat(S.IDSaler),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error al obtener el consecutivo: ".concat(e.status," ").concat(e.statusText));let t=await e.json();if(!t[0].consecutivo||!t[0].Prefijo)throw Error("Los campos 'consecutivo' o 'Prefijo' no se encontraron en la respuesta.");return t[0]}catch(e){throw console.error("Error al obtener el consecutivo:",e),e}},Q=async()=>{if(o(),!(await j().fire({title:"Almacenar!",text:"\xbfDesea almacenar el Pedido?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"})).isConfirmed){j().fire({text:"El Pedido no se almacen\xf3.",icon:"info",timer:3e3});return}try{let e=JSON.parse(localStorage.getItem("pedidos"))||[],t=e.find(e=>e.PKId==e.PKId);if(!t)throw Error("El pedido no se encontr\xf3 en el almacenamiento local.");let o=await Y(),a=o.consecutivo+1,r="".concat(o.Prefijo).concat(a),i=await fetch(w.m.url+"/pedidos/PEDIDOS/".concat(S.IDSaler),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Consecutivo:a})});if(!i.ok)throw console.log("Error al actualizar el consecutivo:",i.statusText),Error("Error al actualizar el consecutivo");console.log("Consecutivo actualizado correctamente");let n={FKID_sellers:t.FKID_sellers,Notas:t.Notas,FKId_clientes:t.FKId_clientes,NUMPED:r,Documento1:t.Documento1},l=await fetch(w.m.url+"/pedidos/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!l.ok){let e=await l.json();throw console.error("Error al crear el pedido",e),Error("Error al crear el encabezado del pedido")}for(let e of(console.log("Pedido creado correctamente"),U.map(e=>({FKid_pedidos2:e.FKid_pedidos2.toString(),FKcodigo_articles:e.PKcodigo,Cantidad:e.cantped,Precio:e.Precio.toString(),Descuento:e.Descuento.toString(),Iva:e.Iva.toString(),Total:e.Total,FKNUMPED:r,BODEGA:e.BODEGA})))){let t=await fetch(w.m.url+"/pedidos/".concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw console.error("Error al crear el detalle del pedido:",e),Error("Error al crear el detalle del pedido: ".concat(t.status," - ").concat(t.statusText))}}console.log("Detalle del pedido creado correctamente");let c=e.filter(e=>e.PKId!==t.PKId);localStorage.setItem("pedidos",JSON.stringify(c)),j().fire({title:"\xa1\xc9xito!",text:"Pedido Fue Almacenado Correctamente.",icon:"success",timer:3e3})}catch(e){console.error("Error:",e),j().fire({title:"Oops...!",text:"Hubo un Problema al Enviar el Pedido.",icon:"error"})}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.A,{container:!0,spacing:2,direction:G?"column":"row",alignItems:"center",justifyContent:"space-between",children:(0,a.jsx)(f.A,{size:12,children:(0,a.jsxs)(i.A,{sx:{display:"flex",flexDirection:G?"column":"row",alignItems:"center",gap:2,marginBottom:2},children:[(0,a.jsx)("h3",{children:(0,a.jsx)("strong",{children:"PEDIDOS"})}),(0,a.jsxs)(i.A,{sx:{display:"flex",flexDirection:G?"column":"row",alignItems:"center",gap:2,marginLeft:G?0:"auto",width:G?"100%":"auto"},children:[(0,a.jsx)(n.A,{onClick:()=>y(!0),variant:"contained",sx:{margin:1,backgroundColor:"#841dec",color:"white"},children:"Articulos"}),(0,a.jsx)(n.A,{onClick:Q,variant:"contained",sx:{margin:1,backgroundColor:"#25ba25",color:"white"},children:"Pedido"}),(0,a.jsx)(n.A,{onClick:()=>{let e=JSON.parse(localStorage.getItem("cotizacion"))||[],a=e.findIndex(e=>e.PKId===t.PKId);if(-1!==a){let t={...e[a],articulosSeleccionados:U,impuesto:B,descuento:L,total:P,subTotal:O,notas:b,Documento1:R};e[a]=t,localStorage.setItem("cotizacion",JSON.stringify(e)),o(),j().fire({position:"top-end",title:"\xc9xito",text:"Los cambios se han guardado correctamente.",icon:"success",showConfirmButton:!1,timer:2e3})}else j().fire({title:"Error",text:"No se encontr\xf3 el pedido a actualizar.",icon:"error",confirmButtonText:"Aceptar"})},variant:"contained",sx:{margin:1,backgroundColor:"#d92020",color:"white"},children:"Cambios y Cerrar"})]})]})})}),(0,a.jsx)(l.A,{}),(0,a.jsx)(f.A,{size:{xs:12,sm:6},sx:{marginRigth:4,padding:2},children:(0,a.jsxs)(i.A,{sx:{display:"flex",flexDirection:G?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,a.jsx)(c.A,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:D}),(0,a.jsx)(c.A,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:K}),(0,a.jsx)(c.A,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:A})]})}),(0,a.jsx)(f.A,{size:{xs:12,sm:6},sx:{padding:2},children:(0,a.jsxs)(i.A,{sx:{display:"flex",flexDirection:G?"column":"row",justifyContent:"center",alignItems:"center",gap:2,width:G?"100%":"auto"},children:[(0,a.jsx)(s.A,{id:"standard-multiline-flexible",label:"Ingresar Notas",multiline:!0,maxRows:5,variant:"outlined",value:b,onChange:e=>I(e.target.value),sx:{width:400},inputProps:{maxLength:255}}),(0,a.jsx)(s.A,{id:"standard-multiline-flexible",label:"Documento",multiline:!0,maxRows:3,variant:"outlined",value:R,onChange:e=>J(e.target.value),sx:{width:200},inputProps:{maxLength:50}}),(0,a.jsxs)(c.A,{variant:"body1",children:["SubTotal: ",(0,a.jsxs)("span",{style:{color:"red"},children:["$",O]})]}),(0,a.jsxs)(c.A,{variant:"body1",children:["Total: ",(0,a.jsxs)("span",{style:{color:"red"},children:["$",P]})]})]})}),(0,a.jsx)(f.A,{size:12,sx:{flexGrow:1,marginBottom:2},children:(0,a.jsx)(i.A,{sx:{width:"100%",heigth:G?500:750},children:(0,a.jsx)(g.z,{rows:U,columns:M,getRowId:e=>e.PKcodigo,rowHeight:40,pageSizeOptions:[10],initialState:{pagination:{paginationModel:{pageSize:10}}}})})}),(0,a.jsx)(d.A,{open:F,onClose:q,children:(0,a.jsx)(i.A,{sx:C,children:(0,a.jsx)(u.default,{handleClose:q,onAgregarArticulo:e=>{let t=[...U,...e.map(e=>{let t=e.Precio*(1+e.Iva/100)*e.cantped;return{...e,Total:t.toFixed(0)}})];$(t),X(t)}})})})]})}},54941:(e,t,o)=>{o.r(t),o.d(t,{default:()=>m});var a=o(95155),r=o(23165),i=o(19293),n=o(2572),l=o(22282),c=o(2241),s=o(6283),d=o(30251),u=o(12115),h=o(48097);let m=e=>{let{handleClose:t,onAgregarArticulo:o}=e,[m,g]=(0,u.useState)([]),[x,p]=(0,u.useState)(""),[f,w]=(0,u.useState)({}),[S,j]=(0,u.useState)([]),C=(0,r.A)("(max-width: 600px)");(0,u.useEffect)(()=>{(async()=>{try{let e=await (0,s.Xv)(),t=await e.getAll("articles");t.length>0?(g(t),j(t),console.log("Datos cargados desde la base de datos")):console.log("No se encontraron art\xedculos en la base de datos.")}catch(e){console.log("Error al obtener los productos:",e)}})()},[]);let A=(e,t)=>{w({...f,[e]:t})},v=e=>{g(S.filter(t=>Object.values(t).map(e=>e?e.toString().toLowerCase():"").some(t=>t.includes(e.toLowerCase()))))},b=[{field:"PKcodigo",headerName:"Cod",width:100},{field:"Nombre",headerName:"Referencia",width:280},{field:"Unidad_Empaque",headerName:"Emp",width:80},{field:"Precio",headerName:"Precio",width:90,editable:!0,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString())}},{field:"Iva",headerName:"Iva",width:80},{field:"Descuento",headerName:"Des",width:80,editable:!0},{field:"cantped",headerName:"Cant",width:100,renderCell:e=>(0,a.jsx)(i.A,{size:"small",value:f[e.id]||"",onChange:t=>A(e.id,t.target.value),sx:{width:"70px",height:"20px"}})},{field:"Precio_Neto",headerName:"Neto",width:80,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString())}},{field:"Disp",headerName:"Disp",width:80}];return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(h.A,{container:!0,direction:"column",sx:{minHeight:"100vh",backfroundColor:"#ffffff",padding:2},children:[(0,a.jsx)(h.A,{size:12,children:(0,a.jsxs)(n.A,{sx:{display:"flex",flexDirection:C?"column":"row",alignItems:"center",gap:2,marginBottom:2},children:[(0,a.jsx)("h2",{children:(0,a.jsx)("strong",{children:"SELECCIONAR ARTICULO"})}),(0,a.jsxs)(n.A,{sx:{display:"flex",flexDirection:C?"column":"row",alignItems:"center",gap:2,marginLeft:C?0:"auto",width:C?"100%":"auto"},children:[(0,a.jsx)(l.A,{variant:"outlined",color:"success",sx:{margin:1},onClick:()=>{o(m.filter(e=>f[e.PKcodigo]).map(e=>({...e,cantped:f[e.PKcodigo]}))),t()},children:"Agregar"}),(0,a.jsx)(l.A,{variant:"contained",color:"error",onClick:t,children:"Cerrar"})]})]})}),(0,a.jsx)(c.A,{}),(0,a.jsx)(h.A,{size:12,sx:{padding:2},children:(0,a.jsx)(i.A,{id:"outlined-basic",label:"Digite Codigo o Referencia para Buscar",multiline:!0,rows:1,variant:"outlined",value:x,onChange:e=>{e.preventDefault(),p(e.target.value),v(e.target.value)},sx:{width:"100%"}})}),(0,a.jsx)(h.A,{size:12,sx:{flexGrow:1,marginBottom:2},children:(0,a.jsx)(n.A,{sx:{width:"100%",height:C?500:820},children:(0,a.jsx)(d.z,{density:"compact",rows:m,columns:b,getRowId:e=>e.PKcodigo,processRowUpdate:e=>{let t=m.map(t=>t.PKcodigo===e.PKcodigo?{...t,...e}:t);return g(t),j(t),e},initialState:{pagination:{paginationModel:{pageSize:20}}},pageSizeOptions:[20]})})})]})})}}}]);