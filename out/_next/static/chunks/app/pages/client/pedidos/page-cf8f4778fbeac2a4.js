(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4101],{80713:function(e,t,o){Promise.resolve().then(o.bind(o,70898))},19492:function(e,t,o){"use strict";var a=o(59018),r=o(57437);t.Z=(0,a.Z)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},44964:function(e,t,o){"use strict";o.r(t);var a=o(57437),r=o(79647),i=o(48965),n=o(17156),l=o(76548),s=o(14595),c=o(59415),d=o(86934),u=o(2265),m=o(80219);t.default=e=>{let{handleClose:t,onAgregarArticulo:o}=e,[h,g]=(0,u.useState)([]),[x,p]=(0,u.useState)(""),[f,w]=(0,u.useState)({}),[C,S]=(0,u.useState)([]),j=(0,r.Z)("(max-width: 600px)");(0,u.useEffect)(()=>{(async()=>{try{let e=await (0,c.zK)(),t=await e.getAll("articles");t.length>0?(g(t),S(t),console.log("Datos cargados desde la base de datos")):console.log("No se encontraron art\xedculos en la base de datos.")}catch(e){console.log("Error al obtener los productos:",e)}})()},[]);let b=(e,t)=>{w({...f,[e]:t})},N=e=>{g(C.filter(t=>Object.values(t).map(e=>e?e.toString().toLowerCase():"").some(t=>t.includes(e.toLowerCase()))))};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(m.Z,{container:!0,direction:"column",sx:{minHeight:"100vh",backfroundColor:"#ffffff",padding:2},children:[(0,a.jsx)(m.Z,{size:12,children:(0,a.jsxs)(n.Z,{sx:{display:"flex",flexDirection:j?"column":"row",alignItems:"center",gap:2,marginBottom:2},children:[(0,a.jsx)("h2",{children:(0,a.jsx)("strong",{children:"SELECCIONAR ARTICULO"})}),(0,a.jsxs)(n.Z,{sx:{display:"flex",flexDirection:j?"column":"row",alignItems:"center",gap:2,marginLeft:j?0:"auto",width:j?"100%":"auto"},children:[(0,a.jsx)(l.Z,{variant:"outlined",color:"success",sx:{margin:1},onClick:()=>{o(h.filter(e=>f[e.PKcodigo]).map(e=>({...e,cantped:f[e.PKcodigo]}))),t()},children:"Agregar"}),(0,a.jsx)(l.Z,{variant:"contained",color:"error",onClick:t,children:"Cerrar"})]})]})}),(0,a.jsx)(s.Z,{}),(0,a.jsx)(m.Z,{size:12,sx:{padding:2},children:(0,a.jsx)(i.Z,{id:"outlined-basic",label:"Digite Codigo o Referencia para Buscar",multiline:!0,rows:1,variant:"outlined",value:x,onChange:e=>{e.preventDefault(),p(e.target.value),N(e.target.value)},sx:{width:"100%"}})}),(0,a.jsx)(m.Z,{size:12,sx:{flexGrow:1,marginBottom:2},children:(0,a.jsx)(n.Z,{sx:{width:"100%",height:j?500:820},children:(0,a.jsx)(d._,{density:"compact",rows:h,columns:[{field:"PKcodigo",headerName:"Cod",width:100},{field:"Nombre",headerName:"Referencia",width:280},{field:"Unidad_Empaque",headerName:"Emp",width:80},{field:"Precio",headerName:"Precio",width:90,editable:!0,valueFormatter:e=>{let t=Number(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString())}},{field:"Iva",headerName:"Iva",width:80},{field:"Descuento",headerName:"Des",width:80,editable:!0},{field:"cantped",headerName:"Cant",width:100,renderCell:e=>(0,a.jsx)(i.Z,{size:"small",value:f[e.id]||"",onChange:t=>b(e.id,t.target.value),sx:{width:"70px",height:"20px"}})},{field:"Precio_Neto",headerName:"Neto",width:80,valueFormatter:e=>{let t=Number(e).toFixed(0);return"$".concat(parseFloat(t).toLocaleString())}},{field:"Disp",headerName:"Disp",width:80}],getRowId:e=>e.PKcodigo,processRowUpdate:e=>{let t=h.map(t=>t.PKcodigo===e.PKcodigo?{...t,...e}:t);return g(t),S(t),e},initialState:{pagination:{paginationModel:{pageSize:20}}},pageSizeOptions:[20]})})})]})})}},70898:function(e,t,o){"use strict";o.r(t);var a=o(57437),r=o(79647),i=o(17156),n=o(76548),l=o(14595),s=o(83719),c=o(48965),d=o(37241),u=o(19492),m=o(47703),h=o(85800),g=o(86934),x=o(2265),p=o(16463),f=o(60335),w=o(44964),C=o(80219),S=o(89967),j=o(64379),b=o.n(j),N=o(87138);let v={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxHeight:"90vh",maxWidth:"80vw",overflowY:"auto",overflowX:"hidden",padding:"16px",bgcolor:"#fff",border:"2px solid #000",boxShadow:24};t.default=()=>{let e=(0,p.useRouter)(),{auth:t,clienteV:o}=(0,h.a)(),[j,I]=(0,x.useState)(""),[D,F]=(0,x.useState)(""),[P,E]=(0,x.useState)(""),[Z,y]=(0,x.useState)(!1),[K,T]=(0,x.useState)(""),[z,O]=(0,x.useState)(""),[k,_]=(0,x.useState)(""),[B,L]=(0,x.useState)(""),[A,R]=(0,x.useState)([]),U=()=>y(!1),M=(0,r.Z)("(max-width: 600px)"),G=e=>{b().fire({title:"\xbfSeguro que desea eliminar el articulo?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar"}).then(t=>{if(t.isConfirmed){let t=A.filter(t=>t.PKcodigo!==e.PKcodigo);R(t),J(t),b().fire("Eliminado","El art\xedculo ha sido eliminado","success")}})},J=e=>{let t=0,o=0,a=0,r=0;e.forEach(e=>{let i=parseFloat(e.Precio),n=parseFloat(e.cantped),l=parseFloat(e.Descuento)/100,s=parseFloat(e.Iva)/100;t+=i*n,a+=i*n*l,r+=i+n*s,o+=parseFloat(e.Total)});let i=Number(t.toFixed(0)).toLocaleString(),n=Number(o.toFixed(0)).toLocaleString(),l=Number(a.toFixed(0)).toLocaleString(),s=Number(r.toFixed(0)).toLocaleString();L(l),T(s),O(i),F(n)},q=async()=>{try{let e=await fetch(S.x.url+"/pedidos/".concat(t.IDSaler),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error al obtener el consecutivo: ".concat(e.status," ").concat(e.statusText));let o=await e.json();if(!o[0].consecutivo||!o[0].Prefijo)throw Error("Los campos 'consecutivo' o 'Prefijo' no se encontraron en la respuesta.");return o[0]}catch(e){throw console.error("Error al obtener el consecutivo:",e),e}},H=async()=>{if(!(await b().fire({title:"Almacenar!",text:"\xbfDesea almacenar el Pedido?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"})).isConfirmed){b().fire({text:"El Pedido no se almacen\xf3.",icon:"info",timer:3e3});return}try{let a=await q(),r=a.consecutivo+1,i="".concat(a.Prefijo).concat(r),n=await fetch(S.x.url+"/pedidos/PEDIDOS/".concat(t.IDSaler),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Consecutivo:r})});if(n.ok)console.log("Consecutivo actualizado correctamente");else throw console.log("Error al actualizar el consecutivo:",n.statusText),Error("Error al actualizar el consecutivo");let l={FKID_sellers:t.IDSaler,Notas:P,FKId_clientes:o.NIT,NUMPED:i,Documento1:k},s=await fetch(S.x.url+"/pedidos/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!s.ok){let e=await s.json();throw console.error("Error al crear el pedido",e),Error("Error al crear el encabezado del pedido")}console.log("Pedido creado correctamente");let c=(parseInt(localStorage.getItem("ultimoFKidPedidos"),10)||0)+1;for(let e of A.map(e=>({FKid_pedidos2:c,FKcodigo_articles:e.PKcodigo,Cantidad:e.cantped,Precio:e.Precio,Descuento:e.Descuento,Iva:e.Iva,Total:e.Total,FKNUMPED:i,BODEGA:e.BODEGA}))){let t=await fetch(S.x.url+"/pedidos/".concat(i),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("Error al crear el detalle del pedido:",e),Error("Error al crear el detalle del pedido: ".concat(t.status," - ").concat(t.statusText))}}console.log("Detalle del pedido creado correctamente"),localStorage.setItem("ultimoFKidPedidos",c),b().fire({title:"\xa1\xc9xito!",text:"Pedido Fue Almacenado Correctamente.",icon:"success",timer:3e3}),e.push("../../pages/pedidoSinEnviar")}catch(e){console.error("Error:",e.message),console.error("Detalles del error:",e),b().fire({title:"Oops...!",text:"Hubo un problema al enviar el pedido.",icon:"error"})}};return(0,x.useEffect)(()=>{(()=>{let e=new Date,t=e.getDate(),o=e.toLocaleString("es-CO",{month:"short"}),a=o.charAt(0).toUpperCase()+o.slice(1),r=e.getFullYear();I("".concat(a," ").concat(t,", ").concat(r))})()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{}),(0,a.jsxs)(C.Z,{container:!0,spacing:2,direction:M?"column":"row",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsx)("h2",{style:{margin:4},children:(0,a.jsx)("strong",{children:"DIGITAR PEDIDO"})}),(0,a.jsx)(C.Z,{size:{xs:12,sm:8},sx:{padding:2},children:(0,a.jsxs)(i.Z,{sx:{display:"flex",flexDirection:M?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,a.jsx)(n.Z,{onClick:()=>y(!0),variant:"contained",sx:{margin:1,backgroundColor:"#4eeacb",color:"white"},children:"Articulos"}),(0,a.jsx)(n.Z,{onClick:()=>{let a=JSON.parse(localStorage.getItem("pedidos"))||[],r=0;a.length>0&&(r=Math.max(...a.map(e=>e.PKId)));let i=r+1;localStorage.setItem("ultimoFKidPedidos",i);let n={PKId:i,Fecha:new Date().toISOString(),nombreC:o.RazonSocial,NitC:o.NIT,total:D,NombreV:t.UserFullName,FKID_sellers:t.IDSaler,Notas:P,NUMPED:"",Documento1:k,pkid:i,FKId_clientes:o.NIT,articulos:A.map(e=>({...e,FKid_pedidos2:i}))};a.push(n),localStorage.setItem("pedidos",JSON.stringify(a)),e.push("../../pages/pedidoSinEnviar"),b().fire({title:"Pedido guardado",text:"El pedido ha sido guardado correctamente.",icon:"success",showConfirmButton:!1,timer:3e3})},variant:"contained",sx:{margin:1,backgroundColor:"#8334f0",color:"white"},children:"Guardar"}),(0,a.jsx)(n.Z,{onClick:()=>{let a=JSON.parse(localStorage.getItem("cotizacion"))||[],r=0;a.length>0&&(r=Math.max(...a.map(e=>e.PKId)));let i=r+1;localStorage.setItem("ultimoFKidPedidos",i);let n={PKId:i,Fecha:new Date().toISOString(),nombreC:o.RazonSocial,NitC:o.NIT,telefonoC:o.Telefono,direccionC:o.Direccion,municipioC:o.CityName,total:D,subTotal:z,impuesto:K,descuento:B,NombreV:t.UserFullName,FKID_sellers:t.IDSaler,Notas:P,NUMPED:"",Documento1:k,articulos:A.map(e=>({...e,FKid_pedidos2:i}))};a.push(n),localStorage.setItem("cotizacion",JSON.stringify(a)),e.push("../../pages/cotizacion"),b().fire({title:"Se creo la Cotizaci\xf3n",text:"Cotizaci\xf3n creada correctamente.",icon:"success",showConfirmButton:!1,timer:3e3})},variant:"contained",sx:{margin:1,backgroundColor:"#c9e60c",color:"white"},children:"Cotizaci\xf3n"}),(0,a.jsx)(n.Z,{onClick:H,variant:"contained",sx:{margin:1},color:"success",children:"Enviar"}),(0,a.jsx)(n.Z,{variant:"contained",sx:{ml:1,mr:2},color:"error",LinkComponent:N.default,href:"../client",children:"Cerrar"})]})})]}),(0,a.jsx)(l.Z,{}),(0,a.jsx)(C.Z,{size:{xs:12,sm:6},sx:{padding:2},children:(0,a.jsxs)(i.Z,{sx:{display:"flex",flexDirection:M?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,a.jsx)(s.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:j}),(0,a.jsx)(s.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:o.RazonSocial}),(0,a.jsx)(s.Z,{sx:{color:"#1947ee",fontWeight:"bold",margin:1},variant:"subtitle2",gutterBottom:!0,children:o.NIT})]})}),(0,a.jsx)(C.Z,{size:{xs:12,sm:6},sx:{padding:2},children:(0,a.jsxs)(i.Z,{sx:{display:"flex",flexDirection:M?"column":"row",justifyContent:"center",alignItems:"center",gap:2,width:M?"100%":"auto"},children:[(0,a.jsx)(c.Z,{id:"standard-multiline-flexible",label:"Ingresar Notas",multiline:!0,maxRows:5,variant:"outlined",value:P,onChange:e=>E(e.target.value),sx:{width:500},inputProps:{maxLength:255}}),(0,a.jsx)(c.Z,{id:"standard-multiline-flexible",label:"Documento",multiline:!0,maxRows:3,variant:"outlined",value:k,onChange:e=>_(e.target.value),sx:{width:200},inputProps:{maxLength:50}}),(0,a.jsxs)(s.Z,{variant:"body1",children:["SubTotal: ",(0,a.jsxs)("span",{style:{color:"red"},children:["$",z]})]}),(0,a.jsxs)(s.Z,{variant:"body1",children:["Total: ",(0,a.jsxs)("span",{style:{color:"red"},children:["$",D]})]})]})}),(0,a.jsx)(C.Z,{size:12,sx:{flexGrow:1,margin:2},children:(0,a.jsx)(i.Z,{sx:{width:"100%",heigth:M?500:750},children:(0,a.jsx)(g._,{rows:A,columns:[{field:"PKcodigo",headerName:"Codigo",width:150},{field:"Nombre",headerName:"Referencia",width:350},{field:"Unidad_Empaque",headerName:"Und Empaque",width:100},{field:"Precio",headerName:"Precio",width:100,valueFormatter:e=>{let t=Number(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())}},{field:"Iva",headerName:"Iva",width:90},{field:"Descuento",headerName:"Desc",width:90},{field:"cantped",headerName:"Cant",width:90},{field:"Total",headerName:"Total",width:100,valueFormatter:e=>{let t=Number(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString("es-ES"))},cellClassName:"total-cell"},{field:"actions",headerName:"",width:70,renderCell:e=>(0,a.jsx)(f.Z,{onClick:()=>G(e.row),"aria-label":"cancel",color:"error",sx:{fontSize:40},children:(0,a.jsx)(u.Z,{})})}],getRowId:e=>e.PKcodigo,rowHeight:40,pageSizeOptions:[10],initialState:{pagination:{paginationModel:{pageSize:10}}},sx:{bgColor:"#ffffff"}})})}),(0,a.jsx)(d.Z,{open:Z,onClose:U,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",disableEnforceFocus:!0,children:(0,a.jsx)(i.Z,{sx:v,children:(0,a.jsx)(w.default,{handleClose:U,onAgregarArticulo:e=>{let t=[...A,...e.map(e=>{let t=e.Precio*(1+e.Iva/100),o=parseFloat(e.cantped),a=parseFloat(e.Descuento)/100;return{...e,Total:(t*o*(1-a)).toFixed(0)}})];R(t),J(t)}})})})]})}}},function(e){e.O(0,[9461,5148,8965,3083,1092,6934,2398,7703,2971,7023,1744],function(){return e(e.s=80713)}),_N_E=e.O()}]);