(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5005],{74989:(e,t,n)=>{Promise.resolve().then(n.bind(n,83242))},83242:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>S});var i=n(95155),a=n(23165),o=n(2572),r=n(894),s=n(2241),l=n(4230),c=n(19293),d=n(12115);let h=(0,n(12983).A)((0,i.jsx)("path",{d:"M11 17h2v-1h1c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1h-3v-1h4V8h-2V7h-2v1h-1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3v1H9v2h2zm9-13H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4V6h16z"}),"LocalAtm");var u=n(51991),x=n(70689),m=n(30251),g=n(76046),p=n(48097),f=n(8889),j=n(78897),C=n.n(j);let w=async()=>{let e=await fetch(f.m.url+"/banks/list",{method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()},A=[{field:"CONSECUTIVO",headerName:"Recibo",width:100},{field:"NIT",headerName:"NIT",width:150},{field:"RazonSocial",headerName:"Raz\xf3n Social",width:400},{field:"FECHA",headerName:"Fecha Recibo",width:200},{field:"TOTAL",headerName:"Total Recibo",width:150}],S=()=>{let{auth:e}=(0,x.A)(),t=(0,g.useRouter)(),[n,j]=(0,d.useState)([]),[S,N]=(0,d.useState)([]),[b,v]=(0,d.useState)(""),[E,T]=(0,d.useState)(null),[y,I]=(0,d.useState)(0),[O,k]=(0,d.useState)(""),[z,R]=(0,d.useState)([]),D=(0,a.A)("(max-width: 600px)");(0,d.useEffect)(()=>{(async()=>{let e=await w();try{e&&j(e)}catch(e){console.log("Error al obtener los datos del banco",e)}})()},[]),(0,d.useEffect)(()=>{(async()=>{try{let t=await fetch(f.m.url+"/receipts/consult/Consignment?ProfileName=Vendedor&ID=".concat(e.ID,"&data=Pendiente"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("Error en la solicitud: ".concat(t.status));let n=await t.json();N(n)}catch(e){console.log("Error al obtener los datos de Pedidos Pendientes",e)}})()},[]);let L=(0,d.useCallback)(e=>{R(e);let t=e.reduce((e,t)=>{let n=S.find(e=>e.CONSECUTIVO===t);if(n&&n.TOTAL){let t=n.TOTAL.toString().replace(/[$,]/g,"");return e+(t=parseFloat(t)||0)}return e},0);I("".concat(Number(t.toFixed(2)).toLocaleString()))},[S]),V=async()=>{let n={BankId:E,UserId:e.IDSaler,ConsignmentNumber:O,Total:y,Comments:b,Receipts:z};try{let e=await fetch(f.m.url+"/consignments/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){let t=await e.json();console.error("Error del Servidor",t),C().fire({icon:"error",title:"Error al crear la consignaci\xf3n",text:t.error||"Error Desconocido."});return}let i=await e.json();console.log("Respuesta exitosa",i),C().fire({icon:"success",title:"Consignaci\xf3n creada con \xe9xito",text:i.text}),t.push("./consignacion")}catch(e){console.error("Error de conexi\xf3n",e),C().fire({icon:"error",title:"Error de Red",text:"No se pudo conectar al servidor. Intente nuevamente m\xe1s tarde."})}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.A,{}),(0,i.jsxs)(o.A,{sx:{padding:2},children:[(0,i.jsxs)(o.A,{sx:{display:"flex",flexDirection:D?"column":"row",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h2",{children:(0,i.jsx)("strong",{children:"ELABORAR CONSIGNACI\xd3N"})}),(0,i.jsx)(r.A,{onClick:V,title:"Generar Consignaci\xf3n",children:(0,i.jsx)(h,{sx:{fontSize:60},color:"primary"})})]}),(0,i.jsx)(s.A,{}),(0,i.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:4},children:[(0,i.jsxs)(p.A,{container:!0,spacing:2,sx:{flexDirection:D?"column":"row"},children:[(0,i.jsxs)(p.A,{size:{xs:12,md:6},children:[(0,i.jsx)("strong",{children:"Banco: "}),(0,i.jsx)(l.A,{id:"bank-selector",fullWidth:!0,size:"small",disablePortal:!0,options:n,getOptionLabel:e=>e.BankName||"","aria-required":!0,onChange:(e,t)=>{T(t?t.ID:null)},renderInput:e=>(0,i.jsx)(c.A,{...e,label:"Seleccione el Banco"})})]}),(0,i.jsxs)(p.A,{size:{xs:12,md:6},children:[(0,i.jsx)("strong",{children:"Numero de Consignaci\xf3n: "}),(0,i.jsx)(c.A,{value:O,onChange:e=>k(e.target.value),size:"small",variant:"outlined",fullWidth:!0})]})]}),(0,i.jsx)("strong",{children:"Comentarios: "}),(0,i.jsx)(c.A,{value:b,onChange:e=>v(e.target.value),id:"outlined-basic",multiline:!0,size:"small",variant:"outlined",fullWidth:!0})]}),(0,i.jsx)(o.A,{sx:{height:295,width:"100%",mt:4},children:(0,i.jsx)(m.z,{rows:S,columns:A,getRowId:e=>e.CONSECUTIVO,pageSizeOptions:[5],checkboxSelection:!0,disableRowSelectionOnClick:!0,density:"compact",onRowSelectionModelChange:e=>L(e),initialState:{pagination:{paginationModel:{pageSize:5}}}})}),(0,i.jsxs)(o.A,{sx:{display:"flex",flexDirection:D?"column":"row",alignItems:"center",gap:2,mt:4},children:[(0,i.jsx)("strong",{children:"Total Consignaci\xf3n: "}),(0,i.jsx)(c.A,{value:y,variant:"outlined",size:"small",fullWidth:D,sx:{width:D?"100%":250}})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8320,3509,4017,4269,5065,251,1647,1991,8441,1517,7358],()=>t(74989)),_N_E=e.O()}]);