(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5005],{74989:(e,t,a)=>{Promise.resolve().then(a.bind(a,83242))},83242:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var n=a(95155),r=a(23165),s=a(2572),i=a(894),o=a(2241),l=a(4230),c=a(19293),d=a(12115);let h=(0,a(12983).A)((0,n.jsx)("path",{d:"M11 17h2v-1h1c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1h-3v-1h4V8h-2V7h-2v1h-1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3v1H9v2h2zm9-13H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4V6h16z"}),"LocalAtm");var u=a(51991),m=a(70689),x=a(30251),g=a(76046),C=a(48097),p=a(8889),f=a(78897),j=a.n(f);let A=async()=>{let e=await fetch(p.m.url+"/banks/list",{method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()},N=[{field:"CONSECUTIVO",headerName:"RECIBO",width:100,headerClassName:"header-bold"},{field:"NIT",headerName:"NIT",width:150,headerClassName:"header-bold"},{field:"RazonSocial",headerName:"RAZ\xd3N SOCIAL",width:400,headerClassName:"header-bold"},{field:"FECHA",headerName:"FECHA RECIBO",width:200,headerClassName:"header-bold"},{field:"TOTAL",headerName:"TOTAL RECIBO",width:150,headerClassName:"header-bold"}],w=()=>{let{auth:e}=(0,m.A)(),t=(0,g.useRouter)(),[a,f]=(0,d.useState)([]),[w,S]=(0,d.useState)([]),[E,b]=(0,d.useState)(""),[O,v]=(0,d.useState)(null),[I,T]=(0,d.useState)(0),[y,k]=(0,d.useState)(""),[R,z]=(0,d.useState)([]),L=(0,r.A)("(max-width: 600px)");(0,d.useEffect)(()=>{(async()=>{let e=await A();try{e&&f(e)}catch(e){console.log("Error al obtener los datos del banco",e)}})()},[]),(0,d.useEffect)(()=>{(async()=>{try{let t=await fetch(p.m.url+"/receipts/consult/Consignment?ProfileName=Vendedor&ID=".concat(e.ID,"&data=Pendiente"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("Error en la solicitud: ".concat(t.status));let a=await t.json();S(a)}catch(e){console.log("Error al obtener los datos de Pedidos Pendientes",e)}})()},[]);let D=(0,d.useCallback)(e=>{z(e);let t=e.reduce((e,t)=>{let a=w.find(e=>e.CONSECUTIVO===t);if(a&&a.TOTAL){let t=a.TOTAL.toString().replace(/[$,]/g,"");return e+(t=parseFloat(t)||0)}return e},0);T("".concat(Number(t.toFixed(2)).toLocaleString()))},[w]),B=async()=>{let a={BankId:O,UserId:e.IDSaler,ConsignmentNumber:y,Total:I,Comments:E,Receipts:R};try{let e=await fetch(p.m.url+"/consignments/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok){let t=await e.json();console.error("Error del Servidor",t),j().fire({icon:"error",title:"Error al crear la consignaci\xf3n",text:t.error||"Error Desconocido."});return}let n=await e.json();console.log("Respuesta exitosa",n),j().fire({icon:"success",title:"Consignaci\xf3n creada con \xe9xito",text:n.text}),t.push("./consignacion")}catch(e){console.error("Error de conexi\xf3n",e),j().fire({icon:"error",title:"Error de Red",text:"No se pudo conectar al servidor. Intente nuevamente m\xe1s tarde."})}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.A,{}),(0,n.jsxs)(s.A,{sx:{padding:2},children:[(0,n.jsxs)(s.A,{sx:{display:"flex",flexDirection:L?"column":"row",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("h2",{children:(0,n.jsx)("strong",{children:"ELABORAR CONSIGNACI\xd3N"})}),(0,n.jsx)(i.A,{onClick:B,title:"Generar Consignaci\xf3n",children:(0,n.jsx)(h,{sx:{fontSize:60},color:"primary"})})]}),(0,n.jsx)(o.A,{}),(0,n.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:4},children:[(0,n.jsxs)(C.A,{container:!0,spacing:2,sx:{flexDirection:L?"column":"row"},children:[(0,n.jsxs)(C.A,{size:{xs:12,md:6},children:[(0,n.jsx)("strong",{children:"Banco: "}),(0,n.jsx)(l.A,{id:"bank-selector",fullWidth:!0,size:"small",disablePortal:!0,options:a,getOptionLabel:e=>e.BankName||"","aria-required":!0,onChange:(e,t)=>{v(t?t.ID:null)},renderInput:e=>(0,n.jsx)(c.A,{...e,label:"Seleccione el Banco"})})]}),(0,n.jsxs)(C.A,{size:{xs:12,md:6},children:[(0,n.jsx)("strong",{children:"Numero de Consignaci\xf3n: "}),(0,n.jsx)(c.A,{value:y,onChange:e=>k(e.target.value),size:"small",variant:"outlined",fullWidth:!0})]})]}),(0,n.jsx)("strong",{children:"Comentarios: "}),(0,n.jsx)(c.A,{value:E,onChange:e=>b(e.target.value),id:"outlined-basic",multiline:!0,size:"small",variant:"outlined",fullWidth:!0})]}),(0,n.jsx)(s.A,{sx:{height:295,width:"100%",mt:4},children:(0,n.jsx)(x.z,{rows:w,columns:N,getRowId:e=>e.CONSECUTIVO,pageSizeOptions:[5],checkboxSelection:!0,disableRowSelectionOnClick:!0,density:"compact",onRowSelectionModelChange:e=>D(e),initialState:{pagination:{paginationModel:{pageSize:5}}}})}),(0,n.jsxs)(s.A,{sx:{display:"flex",flexDirection:L?"column":"row",alignItems:"center",gap:2,mt:4},children:[(0,n.jsx)("strong",{children:"Total Consignaci\xf3n: "}),(0,n.jsx)(c.A,{value:I,variant:"outlined",size:"small",fullWidth:L,sx:{width:L?"100%":250}})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8320,6121,9293,4269,6251,251,1647,1991,8441,1517,7358],()=>t(74989)),_N_E=e.O()}]);