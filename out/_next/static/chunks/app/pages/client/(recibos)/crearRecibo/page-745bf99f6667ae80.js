(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1958],{24838:(e,a,r)=>{Promise.resolve().then(r.bind(r,81697))},52035:(e,a,r)=>{"use strict";r.d(a,{A:()=>n});var o=r(12983),t=r(95155);let n=(0,o.A)((0,t.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},7495:(e,a,r)=>{"use strict";r.d(a,{A:()=>n});var o=r(12983),t=r(95155);let n=(0,o.A)((0,t.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},81697:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>N});var o=r(95155),t=r(23165),n=r(79283),i=r(19293),l=r(2572),s=r(894),c=r(60615),d=r(92608),u=r(2241),h=r(22282),m=r(7495),x=r(12115),g=r(52035),f=r(51991),j=r(70689),p=r(30251),A=r(76046),C=r(48097),v=r(8889),w=r(78897),b=r.n(w),D=r(67396);let z=async e=>{let a=await fetch(v.m.url+"/gestioncartera/cartera/".concat(e.nit),{method:"GET",headers:{"Content-Type":"application/json"}});return await a.json()},N=()=>{let e=(0,A.useRouter)(),{auth:a,clienteV:r}=(0,j.A)(),[w,N]=(0,x.useState)(""),[S,y]=(0,x.useState)([]),[E,k]=(0,x.useState)({}),[P,I]=(0,x.useState)(!1),[T,R]=(0,x.useState)(!1),[q,F]=(0,x.useState)(""),[V,L]=(0,x.useState)([]),[W,M]=(0,x.useState)(""),[O,B]=(0,x.useState)({Efectivo:!1,Cheque:!1,ConsignaciÃ³n:!1}),[_,G]=(0,x.useState)([{banco:"",fecha:"",valor:"",numero:""}]),$=(0,t.A)("(max-width: 600px)"),U=()=>{I(!0)},J=()=>{I(!1)},Y=e=>{let a=[..._];a.splice(e,1),G(a)},H=(e,a,r)=>{let o=[..._];o[e][a]=r,G(o)},K=e=>{let{name:a,checked:r}=e.target;B(e=>({...e,[a.toLowerCase()]:r})),"Cheque"===a&&r?U():J(),X(r)},Q=Object.values(O).some(e=>e),X=(0,x.useCallback)(()=>{R(w&&""!==w.trim()||Q)},[w,Q]);(0,x.useEffect)(()=>{(async()=>{if(r&&r.NIT){let e=(await z({nit:r.NIT})).data;e&&e.length>0&&(y(e),console.log("Datos obtenidos correctamente"))}else console.log("Error al obtener los datos")})()},[r]);let Z=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",day:"numeric",month:"numeric"}),ee=(e,a)=>{let r=parseFloat(a)||0;if(r<0){b().fire({icon:"error",title:"Valor Inv\xe1lido",text:"El valor no puede ser negativo."});return}let o=S.map(a=>{if(a.Documento===e){if(!(0>=(parseFloat(a.Saldo.replace(/[$,]/g,""))||0)))return{...a,valorAPagar:r||0};b().fire({icon:"error",title:"Error, Llamar a Cartera!",text:"Esta factura est\xe1 pendiente por Asentar."})}return a});y(o),k(a=>({...a,[e]:r||0})),eo(o),L(a=>Array.isArray(a)?[...a,{NumeroDocumento:e,ValorCancelado:r}]:[{NumeroDocumento:e,ValorCancelado:r}])},ea=(e,a)=>{let r=e.target.checked,o=S.map(e=>e.Documento===a.Documento?{...e,selected:r,valorAPagar:r?e.Saldo:0,inputDisabled:r}:e);y(o),eo(o),L(e=>(Array.isArray(e)||(e=[]),r)?[...e,{NumeroDocumento:a.Documento,ValorCancelado:a.Saldo}]:e.filter(e=>e.Documento!==a.Documento))},er=[{field:"Documento",headerName:"Documento",width:150},{field:"TipoDocumento",headerName:"Tipo",width:150},{field:"Monto",headerName:"Monto",width:150},{field:"FechaDocumento",headerName:"Fecha Documento",width:150,renderCell:e=>Z(e.value)},{field:"FechaVencimiento",headerName:"Fecha Vencimiento",width:150},{field:"Plazo",headerName:"Plazo (D\xedas)",width:150},{field:"DiasVencimiento",headerName:"D\xedas Vencidos",width:150,cellClassName:"plazo-cell"},{field:"Saldo",headerName:"Saldo",width:150},{field:"boton",headerName:"",width:70,renderCell:e=>(0,o.jsx)(n.A,{checked:e.row.selected||!1,onChange:a=>ea(a,e.row),sx:{color:e.row.selected?"green":void 0,"&.Mui-checked":{color:"green"}}})},{field:"cuadro",headerName:"",width:150,renderCell:e=>(0,o.jsx)(i.A,{size:"small",value:e.row.inputDisabled?"":E[e.row.Documento]||"",onChange:a=>ee(e.row.Documento,a.target.value),disabled:e.row.inputDisabled,sx:{width:"120px"}})},{field:"pago",headerName:"Valor a Pagar",width:150,renderCell:e=>(0,o.jsx)(i.A,{size:"small",value:"".concat(void 0!==e.row.valorAPagar&&null!==e.row.valorAPagar?e.row.valorAPagar:0),sx:{width:"120px"},InputProps:{readOnly:!0}})},{field:"StateName",headerName:"Estado",width:150,cellClassName:"total-cell"}],eo=e=>{let a=e.reduce((e,a)=>{let r=a.valorAPagar?a.valorAPagar.toString().replace(/[$,]/g,""):"0";return e+(r=parseInt(r)||0)},0);N("$".concat(Number(a.toFixed(2)).toLocaleString())),X()},et=async()=>{let o=V.reduce((e,a)=>(e[a.NumeroDocumento]=a.ValorCancelado,e),{}),t={};if(O.Cheque&&_.length>0&&(t=_.redudce((e,a,r)=>(e[r]={bank:a.banco,checknumber:a.numero,checkdate:a.fecha,value:a.valor},e),{})),!(await b().fire({title:"Por Favor Confirmar!",text:"\xbfDesea Guardar el Recibo?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"})).isConfirmed){b().fire({text:"No se guardar el recibo.",icon:"info",timer:2e3});return}let n={customer:{nit:r.NIT,razonSocial:r.RazonSocial,email:r.Email,ciudad:r.CityName,departamento:r.DepartmentName},user:{ID:a.ID,UserEmail:a.UserEmail},TOTAL:w,ReciboFisico:q,Comentarios:W,facturas:o,...O.Cheque&&_.length>0&&{cheques:t}};console.log(n);try{let a=await fetch(v.m.url+"/receipts/saveCustomersReceipts/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){let e=await a.json();console.error("Respuesta del Servidor:",e),b().fire({icon:"error",title:"Error al crear la consignaci\xf3n",text:e.error||"Error Desconocido."});return}let r=await a.json();console.log("Recibo creado correctamente",r),b().fire({icon:"success",title:"Recibo Creado",text:"El recibo se cre\xf3 correctamente."}),e.push("./recibo")}catch(e){console.error("Error detallado:",e),b().fire({icon:"error",title:"Error de Conexi\xf3n",text:"No se pudo conectar al servidor o los datos enviados no son v\xe1lidos."})}};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(f.A,{}),(0,o.jsxs)(l.A,{children:[(0,o.jsxs)(l.A,{sx:{display:"flex",flexDirection:$?"column":"row",justifyContent:"space-between",alignItems:"center",m:2},children:[(0,o.jsxs)(C.A,{size:{xs:12,sm:6},children:[(0,o.jsx)("h4",{children:(0,o.jsxs)("strong",{children:["Nit: ",r.NIT," "]})}),(0,o.jsx)("h4",{children:(0,o.jsxs)("strong",{children:["Raz\xf3n Social: ",r.RazonSocial," "]})}),(0,o.jsx)("h4",{children:(0,o.jsxs)("strong",{children:["Email: ",r.Email," "]})})]}),(0,o.jsxs)(C.A,{size:{xs:12,sm:"auto"},container:!0,justifyContent:$?"center":"flex-end",children:[(0,o.jsx)(s.A,{onClick:et,color:"success",disabled:!T,children:(0,o.jsx)(m.A,{sx:{fontSize:40}})}),(0,o.jsx)(s.A,{color:"error",LinkComponent:D.default,href:"../client",children:(0,o.jsx)(g.A,{sx:{fontSize:40}})})]})]}),(0,o.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",m:2},children:(0,o.jsxs)(C.A,{container:!0,spacing:2,sx:{flexDirection:$?"column":"row"},children:[(0,o.jsx)(i.A,{id:"outlined-basic",label:"Escribir Comentario",multiline:!0,variant:"outlined",size:"small",value:W,onChange:e=>M(e.target.value),fullWidth:!0}),(0,o.jsx)(C.A,{size:{xs:12,md:6},children:(0,o.jsx)(i.A,{id:"standard-multiline-flexible",label:"Digite Recibo",multiline:!0,fullWidth:!0,size:"small",variant:"outlined",value:q,onChange:e=>F(e.target.value)})}),(0,o.jsx)(C.A,{size:{xs:12,md:6},children:(0,o.jsx)(i.A,{id:"standard-multiline-flexible",label:"Total",multiline:!0,size:"small",fullWidth:!0,variant:"outlined",value:w,sx:{bgcolor:"#fff",color:"red",fontWeight:"bold"}})}),(0,o.jsxs)(C.A,{size:{xs:12,sm:3},container:!0,spacing:1,sx:{flexDirection:$?"column":"row"},children:[(0,o.jsx)(C.A,{size:{xs:4},children:(0,o.jsx)(c.A,{control:(0,o.jsx)(n.A,{name:"Efectivo",onChange:K,sx:{color:"green","&.Mui-checked":{color:"green"}}}),label:"Efectivo"})}),(0,o.jsx)(C.A,{size:{xs:4},children:(0,o.jsx)(c.A,{control:(0,o.jsx)(n.A,{name:"Cheque",onChange:K,sx:{color:"blue","&.Mui-checked":{color:"blue"}}}),label:"Cheque"})}),(0,o.jsx)(C.A,{size:{xs:4},children:(0,o.jsx)(c.A,{control:(0,o.jsx)(n.A,{name:"Consignaci\xf3n",onChange:K,sx:{color:"red","&.Mui-checked":{color:"red"}}}),label:"Consignaci\xf3n"})})]})]})}),(0,o.jsx)(C.A,{size:12,sx:{flexGrow:1,margin:2},children:(0,o.jsx)(l.A,{sx:{width:"100%",heigth:$?300:500},children:(0,o.jsx)(p.z,{rows:S,columns:er,getRowId:e=>e.Documento,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})})}),(0,o.jsx)(d.A,{open:P,onClose:J,BackdropProps:{onClick:e=>e.stopPropagation()},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,o.jsxs)(l.A,{sx:{p:4,backgroundColor:"white",borderRadius:"8px",maxWidth:"950px",width:"90%",height:"50vh",overflowY:"auto",margin:"auto",mt:4},children:[(0,o.jsx)("strong",{children:"Informaci\xf3n de Cheques"}),(0,o.jsx)(u.A,{}),_.map((e,a)=>(0,o.jsx)(l.A,{sx:{padding:2},children:(0,o.jsxs)(C.A,{container:!0,spacing:2,alignItems:"center",children:[(0,o.jsxs)(C.A,{size:{xs:12,md:2.4},children:[(0,o.jsx)("strong",{children:"Banco: "}),(0,o.jsx)(i.A,{variant:"outlined",fullWidth:!0,margin:"normal",value:e.banco,onChange:e=>H(a,"banco",e.target.value),sx:{width:170}})]}),(0,o.jsxs)(C.A,{size:{xs:12,md:2.4},children:[(0,o.jsx)("strong",{children:"Numero de Cheque: "}),(0,o.jsx)(i.A,{variant:"outlined",fullWidth:!0,margin:"normal",value:e.numero,onChange:e=>H(a,"numero",e.target.value),sx:{width:170}})]}),(0,o.jsxs)(C.A,{size:{xs:12,md:2.4},children:[(0,o.jsx)("strong",{children:"Fecha de Cheque: "}),(0,o.jsx)(i.A,{type:"date",margin:"normal",value:e.fecha,onChange:e=>H(a,"fecha",e.target.value),slotProps:{textField:{variant:"outlined",fullWidth:!0,marginTop:1}}})]}),(0,o.jsxs)(C.A,{size:{xs:12,md:2.4},children:[(0,o.jsx)("strong",{children:"Valor de Cheque: "}),(0,o.jsx)(i.A,{variant:"outlined",fullWidth:!0,margin:"normal",value:e.valor,onChange:e=>H(a,"valor",e.target.value),sx:{width:170}})]}),(0,o.jsx)(C.A,{size:{xs:12,md:2.4},children:(0,o.jsx)(h.A,{onClick:Y,variant:"outlined",color:"error",sx:{display:"flex",justifyContent:"center",alignItems:"center",margin:1},children:"Eliminar"})})]})},a)),(0,o.jsx)(u.A,{}),(0,o.jsx)(C.A,{container:!0,spacing:2,alignItems:"center",children:(0,o.jsx)(C.A,{size:{xs:12,md:6},sx:{padding:2},children:(0,o.jsxs)(l.A,{sx:{flexWrap:"wrap",flexDirection:$?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,o.jsx)(h.A,{onClick:()=>{G([..._,{banco:"",fecha:"",valor:"",numero:""}])},variant:"contained",color:"secondary",sx:{margin:1},children:"A\xf1adir"}),(0,o.jsx)(h.A,{onClick:()=>{if(!_.every(e=>e.banco&&e.fecha&&e.valor&&e.numero)){b().fire({icon:"error",title:"Error",text:"Por favor completa todos los campos antes de guardar."});return}console.log("Datos guardados: ",_),b().fire({icon:"success",title:"Guardado",text:"Los datos se han guardado correctamente."}),G([..._]),J()},variant:"contained",color:"success",sx:{margin:1},children:"Guardar"}),(0,o.jsx)(h.A,{onClick:J,variant:"contained",sx:{margin:1},children:"Cerrar"})]})})})]})})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[8320,3509,4017,4269,5065,251,1647,1991,8441,1517,7358],()=>a(24838)),_N_E=e.O()}]);