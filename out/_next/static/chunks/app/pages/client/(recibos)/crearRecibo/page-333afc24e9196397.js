(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7887],{27556:function(e,a,o){Promise.resolve().then(o.bind(o,87795))},19492:function(e,a,o){"use strict";var r=o(59018),n=o(57437);a.Z=(0,r.Z)((0,n.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},10524:function(e,a,o){"use strict";var r=o(59018),n=o(57437);a.Z=(0,r.Z)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},87795:function(e,a,o){"use strict";o.r(a);var r=o(57437),n=o(79647),t=o(65786),i=o(48965),l=o(17156),s=o(60335),c=o(68038),d=o(37241),u=o(14595),h=o(76548),m=o(10524),x=o(2265),g=o(19492),f=o(47703),j=o(85800),p=o(86934),C=o(16463),v=o(80219),Z=o(89967),w=o(64379),b=o.n(w),D=o(87138);let N=async e=>{let a=await fetch(Z.x.url+"/gestioncartera/cartera/".concat(e.nit),{method:"GET",headers:{"Content-Type":"application/json"}});return await a.json()};a.default=()=>{let e=(0,C.useRouter)(),{auth:a,clienteV:o}=(0,j.a)(),[w,S]=(0,x.useState)(""),[z,y]=(0,x.useState)([]),[E,k]=(0,x.useState)({}),[P,I]=(0,x.useState)(!1),[T,A]=(0,x.useState)(!1),[R,q]=(0,x.useState)(""),[F,V]=(0,x.useState)([]),[L,W]=(0,x.useState)(""),[M,O]=(0,x.useState)({Efectivo:!1,Cheque:!1,ConsignaciÃ³n:!1}),[_,B]=(0,x.useState)([{banco:"",fecha:"",valor:"",numero:""}]),G=(0,n.Z)("(max-width: 600px)"),$=()=>{I(!0)},U=()=>{I(!1)},J=e=>{let a=[..._];a.splice(e,1),B(a)},Y=(e,a,o)=>{let r=[..._];r[e][a]=o,B(r)},H=e=>{let{name:a,checked:o}=e.target;O(e=>({...e,[a.toLowerCase()]:o})),"Cheque"===a&&o?$():U(),Q(o)},K=Object.values(M).some(e=>e),Q=(0,x.useCallback)(()=>{A(w&&""!==w.trim()||K)},[w,K]);(0,x.useEffect)(()=>{(async()=>{if(o&&o.NIT){let e=(await N({nit:o.NIT})).data;e&&e.length>0&&(y(e),console.log("Datos obtenidos correctamente"))}else console.log("Error al obtener los datos")})()},[o]);let X=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",day:"numeric",month:"numeric"}),ee=(e,a)=>{let o=parseFloat(a)||0;if(o<0){b().fire({icon:"error",title:"Valor Inv\xe1lido",text:"El valor no puede ser negativo."});return}let r=z.map(a=>{if(a.Documento===e){if(!(0>=(parseFloat(a.Saldo.replace(/[$,]/g,""))||0)))return{...a,valorAPagar:o||0};b().fire({icon:"error",title:"Error, Llamar a Cartera!",text:"Esta factura est\xe1 pendiente por Asentar."})}return a});y(r),k(a=>({...a,[e]:o||0})),eo(r),V(a=>Array.isArray(a)?[...a,{NumeroDocumento:e,ValorCancelado:o}]:[{NumeroDocumento:e,ValorCancelado:o}])},ea=(e,a)=>{let o=e.target.checked,r=z.map(e=>e.Documento===a.Documento?{...e,selected:o,valorAPagar:o?e.Saldo:0,inputDisabled:o}:e);y(r),eo(r),V(e=>(Array.isArray(e)||(e=[]),o)?[...e,{NumeroDocumento:a.Documento,ValorCancelado:a.Saldo}]:e.filter(e=>e.Documento!==a.Documento))},eo=e=>{let a=e.reduce((e,a)=>{let o=a.valorAPagar?a.valorAPagar.toString().replace(/[$,]/g,""):"0";return e+(o=parseInt(o)||0)},0);S("$".concat(Number(a.toFixed(2)).toLocaleString())),Q()},er=async()=>{let r=F.reduce((e,a)=>(e[a.NumeroDocumento]=a.ValorCancelado,e),{}),n={};if(M.Cheque&&_.length>0&&(n=_.redudce((e,a,o)=>(e[o]={bank:a.banco,checknumber:a.numero,checkdate:a.fecha,value:a.valor},e),{})),!(await b().fire({title:"Por Favor Confirmar!",text:"\xbfDesea Guardar el Recibo?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"})).isConfirmed){b().fire({text:"No se guardar el recibo.",icon:"info",timer:2e3});return}let t={customer:{nit:o.NIT,razonSocial:o.RazonSocial,email:o.Email,ciudad:o.CityName,departamento:o.DepartmentName},user:{ID:a.ID,UserEmail:a.UserEmail},TOTAL:w,ReciboFisico:R,Comentarios:L,facturas:r,...M.Cheque&&_.length>0&&{cheques:n}};console.log(t);try{let a=await fetch(Z.x.url+"/receipts/saveCustomersReceipts/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json();console.error("Respuesta del Servidor:",e),b().fire({icon:"error",title:"Error al crear la consignaci\xf3n",text:e.error||"Error Desconocido."});return}let o=await a.json();console.log("Recibo creado correctamente",o),b().fire({icon:"success",title:"Recibo Creado",text:"El recibo se cre\xf3 correctamente."}),e.push("./recibo")}catch(e){console.error("Error detallado:",e),b().fire({icon:"error",title:"Error de Conexi\xf3n",text:"No se pudo conectar al servidor o los datos enviados no son v\xe1lidos."})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{}),(0,r.jsxs)(l.Z,{children:[(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:G?"column":"row",justifyContent:"space-between",alignItems:"center",m:2},children:[(0,r.jsxs)(v.Z,{size:{xs:12,sm:6},children:[(0,r.jsx)("h4",{children:(0,r.jsxs)("strong",{children:["Nit: ",o.NIT," "]})}),(0,r.jsx)("h4",{children:(0,r.jsxs)("strong",{children:["Raz\xf3n Social: ",o.RazonSocial," "]})}),(0,r.jsx)("h4",{children:(0,r.jsxs)("strong",{children:["Email: ",o.Email," "]})})]}),(0,r.jsxs)(v.Z,{size:{xs:12,sm:"auto"},container:!0,justifyContent:G?"center":"flex-end",children:[(0,r.jsx)(s.Z,{onClick:er,color:"success",disabled:!T,children:(0,r.jsx)(m.Z,{sx:{fontSize:40}})}),(0,r.jsx)(s.Z,{color:"error",LinkComponent:D.default,href:"../client",children:(0,r.jsx)(g.Z,{sx:{fontSize:40}})})]})]}),(0,r.jsx)(l.Z,{sx:{display:"flex",flexDirection:"column",m:2},children:(0,r.jsxs)(v.Z,{container:!0,spacing:2,sx:{flexDirection:G?"column":"row"},children:[(0,r.jsx)(i.Z,{id:"outlined-basic",label:"Escribir Comentario",multiline:!0,variant:"outlined",size:"small",value:L,onChange:e=>W(e.target.value),fullWidth:!0}),(0,r.jsx)(v.Z,{size:{xs:12,md:6},children:(0,r.jsx)(i.Z,{id:"standard-multiline-flexible",label:"Digite Recibo",multiline:!0,fullWidth:!0,size:"small",variant:"outlined",value:R,onChange:e=>q(e.target.value)})}),(0,r.jsx)(v.Z,{size:{xs:12,md:6},children:(0,r.jsx)(i.Z,{id:"standard-multiline-flexible",label:"Total",multiline:!0,size:"small",fullWidth:!0,variant:"outlined",value:w,sx:{bgcolor:"#fff",color:"red",fontWeight:"bold"}})}),(0,r.jsxs)(v.Z,{size:{xs:12,sm:3},container:!0,spacing:1,sx:{flexDirection:G?"column":"row"},children:[(0,r.jsx)(v.Z,{size:{xs:4},children:(0,r.jsx)(c.Z,{control:(0,r.jsx)(t.Z,{name:"Efectivo",onChange:H,sx:{color:"green","&.Mui-checked":{color:"green"}}}),label:"Efectivo"})}),(0,r.jsx)(v.Z,{size:{xs:4},children:(0,r.jsx)(c.Z,{control:(0,r.jsx)(t.Z,{name:"Cheque",onChange:H,sx:{color:"blue","&.Mui-checked":{color:"blue"}}}),label:"Cheque"})}),(0,r.jsx)(v.Z,{size:{xs:4},children:(0,r.jsx)(c.Z,{control:(0,r.jsx)(t.Z,{name:"Consignaci\xf3n",onChange:H,sx:{color:"red","&.Mui-checked":{color:"red"}}}),label:"Consignaci\xf3n"})})]})]})}),(0,r.jsx)(v.Z,{size:12,sx:{flexGrow:1,margin:2},children:(0,r.jsx)(l.Z,{sx:{width:"100%",heigth:G?300:500},children:(0,r.jsx)(p._,{rows:z,columns:[{field:"Documento",headerName:"Documento",width:150},{field:"TipoDocumento",headerName:"Tipo",width:150},{field:"Monto",headerName:"Monto",width:150},{field:"FechaDocumento",headerName:"Fecha Documento",width:150,renderCell:e=>X(e.value)},{field:"FechaVencimiento",headerName:"Fecha Vencimiento",width:150},{field:"Plazo",headerName:"Plazo (D\xedas)",width:150},{field:"DiasVencimiento",headerName:"D\xedas Vencidos",width:150,cellClassName:e=>e.value>0?"saldo_vencido":""},{field:"Saldo",headerName:"Saldo",width:150},{field:"boton",headerName:"",width:70,renderCell:e=>(0,r.jsx)(t.Z,{checked:e.row.selected||!1,onChange:a=>ea(a,e.row),sx:{color:e.row.selected?"green":void 0,"&.Mui-checked":{color:"green"}}})},{field:"cuadro",headerName:"",width:150,renderCell:e=>(0,r.jsx)(i.Z,{size:"small",value:e.row.inputDisabled?"":E[e.row.Documento]||"",onChange:a=>ee(e.row.Documento,a.target.value),disabled:e.row.inputDisabled,sx:{width:"120px"}})},{field:"pago",headerName:"Valor a Pagar",width:150,renderCell:e=>(0,r.jsx)(i.Z,{size:"small",value:"".concat(void 0!==e.row.valorAPagar&&null!==e.row.valorAPagar?e.row.valorAPagar:0),sx:{width:"120px"},InputProps:{readOnly:!0}})},{field:"StateName",headerName:"Estado",width:150,cellClassName:"total-cell"}],getRowId:e=>e.Documento,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})})}),(0,r.jsx)(d.Z,{open:P,onClose:U,BackdropProps:{onClick:e=>e.stopPropagation()},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,r.jsxs)(l.Z,{sx:{p:4,backgroundColor:"white",borderRadius:"8px",maxWidth:"950px",width:"90%",height:"50vh",overflowY:"auto",margin:"auto",mt:4},children:[(0,r.jsx)("strong",{children:"Informaci\xf3n de Cheques"}),(0,r.jsx)(u.Z,{}),_.map((e,a)=>(0,r.jsx)(l.Z,{sx:{padding:2},children:(0,r.jsxs)(v.Z,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsxs)(v.Z,{size:{xs:12,md:2.4},children:[(0,r.jsx)("strong",{children:"Banco: "}),(0,r.jsx)(i.Z,{variant:"outlined",fullWidth:!0,margin:"normal",value:e.banco,onChange:e=>Y(a,"banco",e.target.value),sx:{width:170}})]}),(0,r.jsxs)(v.Z,{size:{xs:12,md:2.4},children:[(0,r.jsx)("strong",{children:"Numero de Cheque: "}),(0,r.jsx)(i.Z,{variant:"outlined",fullWidth:!0,margin:"normal",value:e.numero,onChange:e=>Y(a,"numero",e.target.value),sx:{width:170}})]}),(0,r.jsxs)(v.Z,{size:{xs:12,md:2.4},children:[(0,r.jsx)("strong",{children:"Fecha de Cheque: "}),(0,r.jsx)(i.Z,{type:"date",margin:"normal",value:e.fecha,onChange:e=>Y(a,"fecha",e.target.value),slotProps:{textField:{variant:"outlined",fullWidth:!0,marginTop:1}}})]}),(0,r.jsxs)(v.Z,{size:{xs:12,md:2.4},children:[(0,r.jsx)("strong",{children:"Valor de Cheque: "}),(0,r.jsx)(i.Z,{variant:"outlined",fullWidth:!0,margin:"normal",value:e.valor,onChange:e=>Y(a,"valor",e.target.value),sx:{width:170}})]}),(0,r.jsx)(v.Z,{size:{xs:12,md:2.4},children:(0,r.jsx)(h.Z,{onClick:J,variant:"outlined",color:"error",sx:{display:"flex",justifyContent:"center",alignItems:"center",margin:1},children:"Eliminar"})})]})},a)),(0,r.jsx)(u.Z,{}),(0,r.jsx)(v.Z,{container:!0,spacing:2,alignItems:"center",children:(0,r.jsx)(v.Z,{size:{xs:12,md:6},sx:{padding:2},children:(0,r.jsxs)(l.Z,{sx:{flexWrap:"wrap",flexDirection:G?"column":"row",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)(h.Z,{onClick:()=>{B([..._,{banco:"",fecha:"",valor:"",numero:""}])},variant:"contained",color:"secondary",sx:{margin:1},children:"A\xf1adir"}),(0,r.jsx)(h.Z,{onClick:()=>{if(!_.every(e=>e.banco&&e.fecha&&e.valor&&e.numero)){b().fire({icon:"error",title:"Error",text:"Por favor completa todos los campos antes de guardar."});return}console.log("Datos guardados: ",_),b().fire({icon:"success",title:"Guardado",text:"Los datos se han guardado correctamente."}),B([..._]),U()},variant:"contained",color:"success",sx:{margin:1},children:"Guardar"}),(0,r.jsx)(h.Z,{onClick:U,variant:"contained",sx:{margin:1},children:"Cerrar"})]})})})]})})]})]})}}},function(e){e.O(0,[9461,5148,8965,3083,1092,6934,2398,7703,2971,7023,1744],function(){return e(e.s=27556)}),_N_E=e.O()}]);