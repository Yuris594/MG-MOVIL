(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8695],{60616:function(e,t,o){Promise.resolve().then(o.bind(o,24511))},24511:function(e,t,o){"use strict";o.r(t);var i=o(57437),a=o(70899),r=o(94013),n=o(2069),l=o(77584),d=o(58004),s=o(98730),c=o(10932),f=o(13462),u=o(2265),h=o(93769),m=o(99376),x=o(29239),p=o(41698),C=o(5515),g=o.n(C);let v={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,overflow:"auto",p:4};t.default=()=>{let{auth:e}=(0,c.a)(),t=(0,m.useRouter)(),[o,C]=(0,u.useState)(!1),[w,S]=(0,u.useState)([]),[N,P]=(0,u.useState)([]),[b,I]=(0,u.useState)([]),[E,O]=(0,u.useState)(null),j=(0,a.Z)("(max-width: 600px)"),z=e=>{O(e),C(!0)},y=()=>{C(!1),O(null)};(0,u.useEffect)(()=>{let e=(JSON.parse(localStorage.getItem("cotizacion"))||[]).map(e=>({...e,fechaFormateada:Z(e.fecha)}));S(e),I(e)},[]);let Z=e=>{let t=new Date(e),o=t.getDate().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getFullYear();return"".concat(i,"/").concat(o,"/").concat(a)},K=e=>{let t=w.filter(t=>t.PKId!==e.PKId);localStorage.setItem("cotizacion",JSON.stringify(t)),S(t)},k=e=>{S(b.filter(t=>Object.values(t).map(e=>e?e.toString().toLowerCase():"").some(t=>t.includes(e.toLowerCase()))))},B=async e=>{if(!navigator.onLine){g().fire({icon:"info",title:"Sin Conexi\xf3n",text:"Revisar la conexi\xf3n a Internet o conectar a la VPN."});return}if(!(await g().fire({title:"Enviar PDF!",text:"\xbfDesea Enviar la Cotizaci\xf3n al Cliente?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"})).isConfirmed){g().fire({text:"El PDF no se envi\xf3.",icon:"info",timer:3e3});return}g().fire({title:"Enviando...",text:"Por favor, espere mientras se env\xeda la cotizaci\xf3n.",allowOutsideClick:!1,didOpen:()=>{g().showLoading()}});try{let t=await fetch(p.x.url+"/cotizacion/enviarPdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e})}),o=await t.json();t.ok?(g().close(),g().fire({title:"\xa1\xc9xito!",text:"La Cotizaci\xf3n fue Enviada.",icon:"success",timer:3e3})):g().fire({icon:"error",title:"Oops..!",text:o.message})}catch(e){console.error("Error generando el PDF:",e),g().fire({icon:"error",title:"Oops..!",text:"Revisar el Email del cliente, No se puede enviar la cotizaci\xf3n."})}},D=async()=>{if(!(await g().fire({title:"\xbfEst\xe1s Seguro?",text:"El pedido ser\xe1 movido de Cotizaciones a Pedidos Por Enviar.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, mover",cancelButtonText:"Cancelar"})).isConfirmed){g().fire({text:"El Pedido no se movi\xf3 y permance en Cotizaciones.",icon:"info",timer:3e3,showConfirmButton:!1});return}try{let o=JSON.parse(localStorage.getItem("pedidos"))||[],i=JSON.parse(localStorage.getItem("cotizacion"))||[],a=i.find(e=>e.PKId==e.PKId);if(!a){g().fire({title:"Pedido no encontrado",text:"No se pudo localizar el pedido en las cotizaciones. Por favor, revisa nuevamente.",icon:"error"});return}let r={PKId:a.PKId,Fecha:a.fecha,nombreC:a.nombreC,NitC:a.nit,total:a.total,NombreV:e.UserFullName,FKID_sellers:a.FKID_sellers,Notas:a.notas,NUMPED:"",Documento1:a.Documento1,pkid:a.PKId,FKId_clientes:a.nit,articulos:a.articulosSeleccionados};if(o.some(e=>e.PKId===r.PKId))g().fire({title:"Pedido dupliado",text:"El pedido ya fue movido anteriormente a Pedidos Por Enviar.",icon:"info"});else{o.push(r),localStorage.setItem("pedidos",JSON.stringify(o));let e=i.filter(e=>e.PKId!==a.PKId);localStorage.setItem("cotizacion",JSON.stringify(e)),await g().fire({title:"\xa1Movimiento Exitoso!",text:"El pedido ha sido guardado correctamente en Pedidos Por Enviar.",icon:"success",timer:3e3,showConfirmButton:!1}),t.push("../pedidoSinEnviar/")}}catch(e){console.error("Error:",e),g().fire({title:"Oops...!",text:"Ocurri\xf3 un problema al intentar guardar el pedido. Intenta nuevamente.",icon:"error"})}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Z,{}),(0,i.jsxs)(x.Z,{container:!0,direction:"column",sx:{minHeight:"100vh",backfroundColor:"#ffffff",padding:3},children:[(0,i.jsxs)(n.Z,{sx:{display:"flex",flexDirection:j?"column":"row",alignItems:"center",justifyContent:"space-between",mb:3},children:[(0,i.jsx)(x.Z,{size:{xs:12,sm:6},children:(0,i.jsx)("h2",{children:(0,i.jsx)("strong",{children:"LISTA DE COTIZACIONES"})})}),(0,i.jsx)(x.Z,{size:{xs:12,sm:6},children:(0,i.jsx)(l.Z,{variant:"outlined",value:N,onChange:e=>{P(e.target.value),k(e.target.value),console.log(e.target.value)},label:"Buscar",sx:{width:"100%",backgroundColor:"#fff"}})})]}),(0,i.jsx)(x.Z,{size:12,sx:{flexGrow:1},children:(0,i.jsx)(n.Z,{sx:{width:"100%",heigth:j?500:750,borderRadius:2},children:(0,i.jsx)(h._,{rows:w,columns:[{field:"PKId",headerName:"No",width:80,headerClassName:"header-bold"},{field:"fechaFormateada",headerName:"FECHA",width:150,headerClassName:"header-bold"},{field:"nit",headerName:"NIT",width:150,headerClassName:"header-bold"},{field:"nombreC",headerName:"NOMBRE O RAZON SOCIAL",width:400,headerClassName:"header-bold"},{field:"enviar",headerName:"",width:100,renderCell:e=>(0,i.jsx)(r.Z,{onClick:()=>B(e.row),"aria-label":"enviar",color:"secondary",sx:{fontSize:12},children:"Enviar PDF"})},{field:"crearPedido",headerName:"",width:160,renderCell:e=>(0,i.jsx)(r.Z,{onClick:()=>D(e.row),"aria-label":"crear",color:"success",sx:{fontSize:12},children:"Convertir a Pedido"})},{field:"editar",headerName:"",width:100,renderCell:e=>(0,i.jsx)(r.Z,{onClick:()=>z(e.row),"aria-label":"editar",sx:{fontSize:12},children:"Modificar"})},{field:"actions",headerName:"",width:100,renderCell:e=>(0,i.jsx)(r.Z,{onClick:()=>K(e.row),"aria-label":"cancel",color:"error",sx:{fontSize:12},children:"Eliminar"})}],getRowId:e=>e.PKId,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,20,30]})})})]}),(0,i.jsx)(d.Z,{open:o,onClose:y,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,i.jsx)(n.Z,{sx:v,children:(0,i.jsx)(f.default,{pedido:E,handleClose:y})})})]})}}},function(e){e.O(0,[9461,173,7584,5615,1238,3840,3683,8730,3462,2971,2117,1744],function(){return e(e.s=60616)}),_N_E=e.O()}]);