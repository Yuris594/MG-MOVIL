(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7284],{68797:function(e,t,a){Promise.resolve().then(a.bind(a,7636))},7636:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var o=a(57437),l=a(70899),r=a(2069),i=a(94013),n=a(8350),s=a(98730),d=a(10932);a(2578);var c=a(53375),h=a(56424),_=a(2265),u=function(e,t,a){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},[n]=(0,_.useState)(null),[s,d]=(0,_.useState)(""),[u]=(0,_.useState)((0,h.WU)(new Date,"dd/MM/yyyy HH:mm:ss"));return(0,_.useEffect)(()=>{(null==e?void 0:e.Fecha)&&(()=>{let t=new Date(e.Fecha),a=t.getDate(),o=t.toLocaleString("es-CO",{month:"short"}),l=o.charAt(0).toUpperCase()+o.slice(1),r=t.getFullYear();d("".concat(l," ").concat(a,", ").concat(r))})()},[e]),{generarPDF:()=>{let n=new c.default("portrait","pt","letter"),d=[{field:"FKcodigo_articles",headerName:"CODIGO",width:150},{field:"Nombre",headerName:"REFERENCIA",width:350},{field:"Cantidad",headerName:"CANTIDAD",width:100},{field:"Precio",headerName:"PRECIO",width:100},{field:"Descuento",headerName:"DESC",width:90},{field:"Iva",headerName:"IVA",width:90},{field:"Total",headerName:"TOTAL",width:100,cellClassName:"total-cell"}],h=a.map(e=>{let t=[];return d.forEach(a=>{let o=e[a.field];("Precio"===a.field||"Total"===a.field)&&(o="$"+parseFloat(Number(o).toFixed(0)).toLocaleString()),t.push(o)}),t});n.setFontSize(13),n.addImage("/logo_factura.png","PNG",16,20,200,25),n.setFontSize(8),n.setFont("courier","italic"),n.text("NOMBRE VENDEDOR: ".concat(t.UserFullName),450,25),n.text("".concat(u),450,35),n.setFontSize(10),n.text("___________________________________________________________________________________________________________",0,60),n.setFont("times","normal"),n.setFontSize(10),n.text("R. SOCIAL: ".concat(null==e?void 0:e.RazonSocial),16,85),n.text("No. PEDIDO: ".concat(null==e?void 0:e.NUMPED),16,105),n.text("FECHA PEDIDO: ".concat(s),200,105),n.text("NIT: ".concat(null==e?void 0:e.FKId_clientes),400,105),n.text("No. FACTURA: ",16,125),n.text("FECHA FACTURA: ",200,125),n.text("DOCUMENTO1: ".concat(null==e?void 0:e.Documento1),400,125),n.text("NOTAS: ".concat(null==e?void 0:e.Notas),16,145),n.autoTable({head:[d.map(e=>e.headerName)],body:h,startY:180,theme:"plain",tableWidth:n.internal.pageSize.width-28,margin:{left:12,right:16},styles:{theme:"plain",cellWidth:"auto",styles:{cellPadding:5,fontSize:8},lineColor:[200,200,200],lineWidth:.1,font:"times",fontStyle:"normal",textColor:[0,0,0],display:"flex",fontSize:8},headStyles:{font:"courier",fontStyle:"bold"}}),n.setFontSize(10),n.setFont("times","italic"),n.text("TOTAL ITEMS:        ".concat(null==a?void 0:a.length),350,n.autoTable.previous.finalY+80),n.text("SubTotal:     $".concat(l),470,n.autoTable.previous.finalY+20),n.text("Desc:         $".concat(i,"  "),470,n.autoTable.previous.finalY+40),n.text("IVA:          $".concat(r,"   "),470,n.autoTable.previous.finalY+60),n.text("TOTAL:        $".concat(o),470,n.autoTable.previous.finalY+80),n.rect(10,n.autoTable.previous.finalY+9,450,88),n.rect(463,n.autoTable.previous.finalY+9,120,88),n.output("dataurlnewwindow")},pdfDataUrl:n}},m=a(99376),x=a(93769),f=a(29239),g=a(41698),p=a(5515),N=a.n(p);let F=[{field:"FKcodigo_articles",headerName:"CODIGO",width:150,headerClassName:"header-bold"},{field:"Nombre",headerName:"REFERENCIA",width:400,headerClassName:"header-bold"},{field:"Cantidad",headerName:"CANTIDAD",width:100,headerClassName:"header-bold"},{field:"Precio",headerName:"PRECIO",width:150,valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},headerClassName:"header-bold"},{field:"Descuento",headerName:"DESCUENTO",width:150,valueFormatter:e=>{let t=parseFloat(e).toLocaleString();return"".concat(parseFloat(t).toFixed(1))},headerClassName:"header-bold"},{field:"Iva",headerName:"IVA",width:150,valueFormatter:e=>{let t=parseFloat(e).toLocaleString();return"".concat(parseFloat(t).toFixed(1))},headerClassName:"header-bold"},{field:"Total",headerName:"TOTAL",width:150,cellClassName:"total-cell",valueFormatter:e=>{let t=parseFloat(e).toFixed(0);return"".concat(parseFloat(t).toLocaleString())},headerClassName:"header-bold"}],S=async e=>{let t=await fetch(g.x.url+"/pedidos/Pedidos_Enviados/".concat(e.NUMPED),{method:"GET",headers:{"Content-Type":"application/json"}});return t.ok||400!==t.status?t.json():(console.log("No hay articulos para este cliente"),[])};var C=()=>{let e=(0,m.useRouter)(),{auth:t}=(0,d.a)(),[a,c]=(0,_.useState)(""),[h,p]=(0,_.useState)(""),[C,v]=(0,_.useState)(""),[E,j]=(0,_.useState)(""),[w,D]=(0,_.useState)(""),[b,T]=(0,_.useState)([]),[P,O]=(0,_.useState)(null),{generarPDF:y}=u(P,t,b,a,C,E,w),I=(0,l.Z)("(max-width: 600px)");(0,_.useEffect)(()=>{P&&A(P.NUMPED)},[P]),(0,_.useEffect)(()=>{let e=localStorage.getItem("detallePedido");e&&O(JSON.parse(e)[0])},[]),(0,_.useEffect)(()=>{(null==P?void 0:P.Fecha)&&(()=>{let e=new Date(P.Fecha),t=e.getDate(),a=e.toLocaleString("es-CO",{month:"short"}),o=a.charAt(0).toUpperCase()+a.slice(1),l=e.getFullYear();p("".concat(o," ").concat(t,", ").concat(l))})()},[P]);let A=async()=>{try{let e=await S(P);e&&T(e)}catch(e){console.log(e)}};(0,_.useEffect)(()=>{if(b.length>0){let e=0,t=0,a=0,o=0;b.forEach(l=>{let r=parseFloat(l.Cantidad)||0,i=parseFloat(l.Precio)||0,n=(parseFloat(l.Descuento)||0)/100,s=(parseFloat(l.Iva)||0)/100,d=r*i,c=d*n;a+=i*r*n,o+=i*r*s,e+=d-c+(d-c)*s,t+=d-c}),D(Number(a.toFixed(0)).toLocaleString()),j(Number(o.toFixed(0)).toLocaleString()),v(Number(t.toFixed(0)).toLocaleString()),c(Number(e.toFixed(0)).toLocaleString())}},[b]);let Z=async()=>{try{let e=await fetch(g.x.url+"/pedidoPdf/enviar-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({FKNUMPED:null==P?void 0:P.NUMPED,total:a,subTotal:C,descuento:w,impuesto:E,auth:t.UserFullName})});if(!e.ok)throw Error("Error al enviar el PDF");let o=await e.json();N().fire({icon:"success",title:"Pedido enviado Correctamente.",text:o.message})}catch(e){console.error("Error:",e),N().fire({icon:"error",title:"Error al Enviar el Correo.",text:"Revisar el Email del Cliente, No fue posible enviar el Correo."})}};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.Z,{}),(0,o.jsxs)(r.Z,{sx:{display:"flex",flexDirection:I?"column":"row",justifyContent:"space-between",alignItems:"center",width:"auto",margin:2},children:[(0,o.jsxs)(f.Z,{container:!0,rowSpacing:2,columnSpacing:70,children:[(0,o.jsx)(f.Z,{size:{xs:12,sm:8,md:12},children:(0,o.jsx)("strong",{children:"MIGUEL G\xd3MEZ Y COMPA\xd1\xcdA S.A.S"})}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:12},children:[(0,o.jsx)("strong",{children:"Nombre Vendedor: "}),null==t?void 0:t.UserFullName]})]}),(0,o.jsxs)(r.Z,{sx:{margin:2},children:[(0,o.jsx)(i.Z,{onClick:Z,color:"secondary",children:"Enviar PDF al Cliente"}),(0,o.jsx)(i.Z,{onClick:y,color:"success",children:"Generar PDF"}),(0,o.jsx)(i.Z,{onClick:()=>{localStorage.removeItem("detallePedido"),e.push("/pages/pedidoEnviado")},color:"error",children:"Cerrar"})]})]}),(0,o.jsx)(n.Z,{}),(0,o.jsx)(r.Z,{sx:{display:"flex",margin:2},children:(0,o.jsxs)(f.Z,{container:!0,rowSpacing:2,columnSpacing:14,children:[(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:4},children:[(0,o.jsx)("strong",{children:"No. Pedido: "}),(null==P?void 0:P.NUMPED)||""]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:4},children:[(0,o.jsx)("strong",{children:"Fecha Pedido: "}),h||""]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:4},children:[(0,o.jsx)("strong",{children:"Nit: "}),(null==P?void 0:P.FKId_clientes)||""]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:8},children:[(0,o.jsx)("strong",{children:"R. Social: "}),(null==P?void 0:P.RazonSocial)||""]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:4},children:[(0,o.jsx)("strong",{children:"Fecha Factura: "}),(null==P?void 0:P.Fecha_Factura)||""]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:4},children:[(0,o.jsx)("strong",{children:"SubTotal: "}),(0,o.jsx)("span",{style:{color:"red"},children:C})]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:4},children:[(0,o.jsx)("strong",{children:"Total: "}),(0,o.jsx)("span",{style:{color:"red"},children:a})]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:4},children:[(0,o.jsx)("strong",{children:"Documento1: "}),(null==P?void 0:P.Documento1)||""]}),(0,o.jsxs)(f.Z,{size:{xs:12,sm:8,md:6},children:[(0,o.jsx)("strong",{children:"Notas: "}),(null==P?void 0:P.Notas)||""]})]})}),(0,o.jsx)(r.Z,{sx:{height:"auto",width:"auto",margin:2},children:(0,o.jsx)(x._,{rows:b,columns:F,getRowId:e=>e.FKcodigo_articles,initialState:{pagination:{paginationModel:{page:0,pageSize:10}}},pageSizeOptions:[10],sx:{color:"#000",bgcolor:"#fff"}})})]})}}},function(e){e.O(0,[9461,2505,173,7584,5615,1238,3840,3683,8070,8730,2971,2117,1744],function(){return e(e.s=68797)}),_N_E=e.O()}]);